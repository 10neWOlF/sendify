{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/shubh/Downloads/p2p-react/src/lib/utils.ts"],"sourcesContent":["import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n"],"names":[],"mappings":";;;AAAA;AACA;;;AAEO,SAAS;IAAG,IAAA,IAAA,OAAA,UAAA,QAAA,AAAG,SAAH,UAAA,OAAA,OAAA,GAAA,OAAA,MAAA;QAAG,OAAH,QAAA,SAAA,CAAA,KAAuB;;IACxC,OAAO,CAAA,GAAA,8JAAA,CAAA,UAAO,AAAD,EAAE,CAAA,GAAA,wIAAA,CAAA,OAAI,AAAD,EAAE;AACtB","debugId":null}},
    {"offset": {"line": 29, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/shubh/Downloads/p2p-react/src/components/ui/card.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Card({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card\"\n      className={cn(\n        \"bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-header\"\n      className={cn(\n        \"@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-title\"\n      className={cn(\"leading-none font-semibold\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardDescription({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-description\"\n      className={cn(\"text-muted-foreground text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardAction({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-action\"\n      className={cn(\n        \"col-start-2 row-span-2 row-start-1 self-start justify-self-end\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-content\"\n      className={cn(\"px-6\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-footer\"\n      className={cn(\"flex items-center px-6 [.border-t]:pt-6\", className)}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardAction,\n  CardDescription,\n  CardContent,\n}\n"],"names":[],"mappings":";;;;;;;;;;AAEA;;;AAEA,SAAS,KAAK,KAAoD;QAApD,EAAE,SAAS,EAAE,GAAG,OAAoC,GAApD;IACZ,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,qFACA;QAED,GAAG,KAAK;;;;;;AAGf;KAXS;AAaT,SAAS,WAAW,KAAoD;QAApD,EAAE,SAAS,EAAE,GAAG,OAAoC,GAApD;IAClB,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,8JACA;QAED,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,UAAU,KAAoD;QAApD,EAAE,SAAS,EAAE,GAAG,OAAoC,GAApD;IACjB,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,gBAAgB,KAAoD;QAApD,EAAE,SAAS,EAAE,GAAG,OAAoC,GAApD;IACvB,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,WAAW,KAAoD;QAApD,EAAE,SAAS,EAAE,GAAG,OAAoC,GAApD;IAClB,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,kEACA;QAED,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,YAAY,KAAoD;QAApD,EAAE,SAAS,EAAE,GAAG,OAAoC,GAApD;IACnB,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,QAAQ;QACrB,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,WAAW,KAAoD;QAApD,EAAE,SAAS,EAAE,GAAG,OAAoC,GAApD;IAClB,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,2CAA2C;QACxD,GAAG,KAAK;;;;;;AAGf;MARS","debugId":null}},
    {"offset": {"line": 151, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/shubh/Downloads/p2p-react/src/components/ui/badge.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90\",\n        destructive:\n          \"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60\",\n        outline:\n          \"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction Badge({\n  className,\n  variant,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"span\"> &\n  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"span\"\n\n  return (\n    <Comp\n      data-slot=\"badge\"\n      className={cn(badgeVariants({ variant }), className)}\n      {...props}\n    />\n  )\n}\n\nexport { Badge, badgeVariants }\n"],"names":[],"mappings":";;;;;AACA;AACA;AAEA;;;;;AAEA,MAAM,gBAAgB,CAAA,GAAA,mKAAA,CAAA,MAAG,AAAD,EACtB,kZACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,WACE;YACF,aACE;YACF,SACE;QACJ;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAGF,SAAS,MAAM,KAM6C;QAN7C,EACb,SAAS,EACT,OAAO,EACP,UAAU,KAAK,EACf,GAAG,OAEuD,GAN7C;IAOb,MAAM,OAAO,UAAU,mKAAA,CAAA,OAAI,GAAG;IAE9B,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,cAAc;YAAE;QAAQ,IAAI;QACzC,GAAG,KAAK;;;;;;AAGf;KAhBS","debugId":null}},
    {"offset": {"line": 204, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/shubh/Downloads/p2p-react/src/components/ui/tabs.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Tabs({\n  className,\n  ...props\n}: React.ComponentProps<typeof TabsPrimitive.Root>) {\n  return (\n    <TabsPrimitive.Root\n      data-slot=\"tabs\"\n      className={cn(\"flex flex-col gap-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction TabsList({\n  className,\n  ...props\n}: React.ComponentProps<typeof TabsPrimitive.List>) {\n  return (\n    <TabsPrimitive.List\n      data-slot=\"tabs-list\"\n      className={cn(\n        \"bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction TabsTrigger({\n  className,\n  ...props\n}: React.ComponentProps<typeof TabsPrimitive.Trigger>) {\n  return (\n    <TabsPrimitive.Trigger\n      data-slot=\"tabs-trigger\"\n      className={cn(\n        \"data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction TabsContent({\n  className,\n  ...props\n}: React.ComponentProps<typeof TabsPrimitive.Content>) {\n  return (\n    <TabsPrimitive.Content\n      data-slot=\"tabs-content\"\n      className={cn(\"flex-1 outline-none\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n"],"names":[],"mappings":";;;;;;;AAGA;AAEA;AALA;;;;AAOA,SAAS,KAAK,KAGoC;QAHpC,EACZ,SAAS,EACT,GAAG,OAC6C,GAHpC;IAIZ,qBACE,6LAAC,mKAAA,CAAA,OAAkB;QACjB,aAAU;QACV,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,uBAAuB;QACpC,GAAG,KAAK;;;;;;AAGf;KAXS;AAaT,SAAS,SAAS,KAGgC;QAHhC,EAChB,SAAS,EACT,GAAG,OAC6C,GAHhC;IAIhB,qBACE,6LAAC,mKAAA,CAAA,OAAkB;QACjB,aAAU;QACV,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,uGACA;QAED,GAAG,KAAK;;;;;;AAGf;MAdS;AAgBT,SAAS,YAAY,KAGgC;QAHhC,EACnB,SAAS,EACT,GAAG,OACgD,GAHhC;IAInB,qBACE,6LAAC,mKAAA,CAAA,UAAqB;QACpB,aAAU;QACV,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,mqBACA;QAED,GAAG,KAAK;;;;;;AAGf;MAdS;AAgBT,SAAS,YAAY,KAGgC;QAHhC,EACnB,SAAS,EACT,GAAG,OACgD,GAHhC;IAInB,qBACE,6LAAC,mKAAA,CAAA,UAAqB;QACpB,aAAU;QACV,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,uBAAuB;QACpC,GAAG,KAAK;;;;;;AAGf;MAXS","debugId":null}},
    {"offset": {"line": 284, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/shubh/Downloads/p2p-react/src/lib/signaling.ts"],"sourcesContent":["import { io, Socket } from 'socket.io-client';\r\nimport { SignalingMessage } from '@/types';\r\n\r\nclass SignalingService {\r\n  private socket: Socket | null = null;\r\n  private serverUrl: string = '';\r\n\r\n  connect(serverUrl?: string): Promise<Socket> {\r\n    return new Promise((resolve, reject) => {\r\n      // If already connected, resolve with existing socket\r\n      if (this.socket && this.socket.connected) {\r\n        console.log('Already connected to signaling server:', this.socket.id);\r\n        resolve(this.socket);\r\n        return;\r\n      }\r\n\r\n      // Disconnect existing socket if any\r\n      if (this.socket) {\r\n        this.socket.disconnect();\r\n      }\r\n\r\n      // Determine the correct signaling server URL\r\n      if (serverUrl) {\r\n        this.serverUrl = serverUrl;\r\n      } else {\r\n        // If accessing via IP address, use the same IP for signaling server\r\n        const hostname = window.location.hostname;\r\n        const protocol = window.location.protocol;\r\n        \r\n        console.log('Detected hostname:', hostname);\r\n        console.log('Detected protocol:', protocol);\r\n        \r\n        if (hostname === 'localhost' || hostname === '127.0.0.1') {\r\n          this.serverUrl = 'http://localhost:3003';\r\n        } else {\r\n          // Use the same IP/hostname but port 3003\r\n          this.serverUrl = `${protocol}//${hostname}:3003`;\r\n        }\r\n      }\r\n      \r\n      console.log('Connecting to signaling server:', this.serverUrl);\r\n\r\n      this.socket = io(this.serverUrl, {\r\n        transports: ['polling', 'websocket'], // Try polling first, then websocket\r\n        timeout: 20000, // Increased timeout to 20 seconds\r\n        forceNew: true, // Force a new connection\r\n        reconnection: true,\r\n        reconnectionAttempts: 5,\r\n        reconnectionDelay: 1000,\r\n        upgrade: true, // Allow transport upgrades\r\n        rememberUpgrade: false, // Don't remember the upgrade\r\n      });\r\n\r\n      this.socket.on('connect', () => {\r\n        console.log('Connected to signaling server:', this.socket?.id);\r\n        resolve(this.socket!);\r\n      });\r\n\r\n      this.socket.on('connect_error', (error) => {\r\n        console.error('Signaling connection error:', error);\r\n        // Try to provide more specific error messages\r\n        let errorMessage = 'Connection failed';\r\n        if (error.message) {\r\n          errorMessage = error.message;\r\n        } else if (typeof error === 'string') {\r\n          errorMessage = error;\r\n        }\r\n        reject(new Error(`Connection failed: ${errorMessage}`));\r\n      });\r\n\r\n      this.socket.on('disconnect', (reason) => {\r\n        console.log('Disconnected from signaling server:', reason);\r\n      });\r\n\r\n      // Add a timeout fallback\r\n      setTimeout(() => {\r\n        if (this.socket && !this.socket.connected) {\r\n          reject(new Error('Connection timeout after 20 seconds'));\r\n        }\r\n      }, 20000);\r\n    });\r\n  }\r\n\r\n  isConnected(): boolean {\r\n    return this.socket !== null && this.socket.connected;\r\n  }\r\n\r\n  disconnect(): void {\r\n    if (this.socket) {\r\n      this.socket.disconnect();\r\n      this.socket = null;\r\n    }\r\n  }\r\n\r\n  joinRoom(roomCode: string): void {\r\n    if (this.socket) {\r\n      this.socket.emit('join-room', roomCode);\r\n    }\r\n  }\r\n\r\n  sendSignal(message: SignalingMessage): void {\r\n    if (this.socket) {\r\n      console.log('Sending signal:', message);\r\n      \r\n      // Map the generic signal to specific server events\r\n      switch (message.type) {\r\n        case 'offer':\r\n          this.socket.emit('webrtc-offer', {\r\n            roomId: message.toRoom,\r\n            offer: message.payload\r\n          });\r\n          break;\r\n        case 'answer':\r\n          this.socket.emit('webrtc-answer', {\r\n            roomId: message.toRoom,\r\n            answer: message.payload\r\n          });\r\n          break;\r\n        case 'ice':\r\n          this.socket.emit('webrtc-ice-candidate', {\r\n            roomId: message.toRoom,\r\n            candidate: message.payload\r\n          });\r\n          break;\r\n        default:\r\n          console.warn('Unknown signal type:', message.type);\r\n      }\r\n    }\r\n  }\r\n\r\n  onRoomFull(callback: (data: { room: string }) => void): void {\r\n    if (this.socket) {\r\n      this.socket.on('room-full', callback);\r\n    }\r\n  }\r\n\r\n  onRoomBusy(callback: (data: { room: string }) => void): void {\r\n    if (this.socket) {\r\n      this.socket.on('room-busy', callback);\r\n    }\r\n  }\r\n\r\n  onRoomExpired(callback: () => void): void {\r\n    if (this.socket) {\r\n      this.socket.on('room-expired', callback);\r\n    }\r\n  }\r\n\r\n  onPeerJoined(callback: (peerId: string) => void): void {\r\n    if (this.socket) {\r\n      this.socket.on('peer-joined', callback);\r\n    }\r\n  }\r\n\r\n  onPeerDisconnected(callback: (peerId: string) => void): void {\r\n    if (this.socket) {\r\n      this.socket.on('peer-disconnected', callback);\r\n    }\r\n  }\r\n\r\n  onSignal(callback: (message: SignalingMessage) => void): void {\r\n    if (this.socket) {\r\n      // Listen for WebRTC offer messages\r\n      this.socket.on('webrtc-offer', (data) => {\r\n        console.log('Received WebRTC offer:', data);\r\n        callback({\r\n          type: 'offer',\r\n          payload: data.offer,\r\n          fromPeer: data.from,\r\n          toRoom: '',\r\n        });\r\n      });\r\n\r\n      // Listen for WebRTC answer messages\r\n      this.socket.on('webrtc-answer', (data) => {\r\n        console.log('Received WebRTC answer:', data);\r\n        callback({\r\n          type: 'answer',\r\n          payload: data.answer,\r\n          fromPeer: data.from,\r\n          toRoom: '',\r\n        });\r\n      });\r\n\r\n      // Listen for WebRTC ICE candidate messages\r\n      this.socket.on('webrtc-ice-candidate', (data) => {\r\n        console.log('Received WebRTC ICE candidate:', data);\r\n        callback({\r\n          type: 'ice',\r\n          payload: data.candidate,\r\n          fromPeer: data.from,\r\n          toRoom: '',\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  removeAllListeners(): void {\r\n    if (this.socket) {\r\n      this.socket.off('webrtc-offer');\r\n      this.socket.off('webrtc-answer');\r\n      this.socket.off('webrtc-ice-candidate');\r\n      this.socket.off('peer-joined');\r\n      this.socket.off('peer-disconnected');\r\n      this.socket.off('room-full');\r\n      this.socket.off('room-busy');\r\n      this.socket.off('room-expired');\r\n    }\r\n  }\r\n\r\n  get id(): string | null {\r\n    return this.socket?.id || null;\r\n  }\r\n\r\n  get connected(): boolean {\r\n    return this.socket?.connected || false;\r\n  }\r\n}\r\n\r\nexport const signalingService = new SignalingService();\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 498, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/shubh/Downloads/p2p-react/src/lib/webrtc.ts"],"sourcesContent":["import { FileMetadata, SignalingMessage, DataChannelMessage, FileTransferProgress } from '@/types';\r\nimport { signalingService } from './signaling';\r\n\r\nexport class WebRTCService {\r\n  private peerConnection: RTCPeerConnection | null = null;\r\n  private dataChannel: RTCDataChannel | null = null;\r\n  private roomCode: string = '';\r\n  private role: 'sender' | 'receiver' | null = null;\r\n  \r\n  // Configuration\r\n  private readonly config: RTCConfiguration = {\r\n    iceServers: [\r\n      { urls: 'stun:stun.l.google.com:19302' },\r\n      { urls: 'stun:stun1.l.google.com:19302' },\r\n      { urls: 'stun:stun2.l.google.com:19302' },\r\n    ],\r\n  };\r\n\r\n  private readonly chunkSize = 64 * 1024; // 64KB chunks (original stable setting)\r\n  private readonly maxBufferSize = 8 * 1024 * 1024; // 8MB max buffer (original stable setting)\r\n\r\n  // Event handlers\r\n  public onConnectionStateChange?: (state: RTCPeerConnectionState) => void;\r\n  public onDataChannelOpen?: () => void;\r\n  public onDataChannelClose?: () => void;\r\n  public onFileReceived?: (file: File) => void;\r\n  public onIncomingFiles?: (files: FileMetadata[]) => void; // New callback for incoming file list\r\n  public onTransferProgress?: (progress: { \r\n    fileName: string; \r\n    fileIndex: number; // Add file index to progress\r\n    progress: number; \r\n    bytesTransferred: number; \r\n    totalBytes: number;\r\n    speed: number;\r\n  }) => void;\r\n  public onTransferComplete?: () => void;\r\n  public onTransferCancelled?: (cancelledBy: 'sender' | 'receiver') => void;\r\n  public onFileCancelled?: (data: { fileIndex: number; fileName: string; cancelledBy: 'sender' | 'receiver' }) => void;\r\n  public onError?: (error: string) => void;\r\n\r\n  // Transfer state\r\n  private currentFiles: File[] = [];\r\n  private receiveBuffers: ArrayBuffer[] = [];\r\n  private currentFileIndex = 0;\r\n  private currentFileMeta: FileMetadata | null = null;\r\n  private transferStartTime = 0;\r\n  private receivedBytes = 0;\r\n  private lastProgressSync = 0; // Throttle progress sync messages\r\n  private cancelledFileIndices = new Set<number>(); // Track cancelled files\r\n\r\n  // Getters\r\n  get currentRole(): 'sender' | 'receiver' | null {\r\n    return this.role;\r\n  }\r\n\r\n  async initializeAsSender(roomCode: string, files: File[]): Promise<void> {\r\n    this.roomCode = roomCode;\r\n    this.role = 'sender';\r\n    this.currentFiles = files;\r\n\r\n    await this.createPeerConnection();\r\n    this.createDataChannel();\r\n    \r\n    // Create offer\r\n    const offer = await this.peerConnection!.createOffer();\r\n    await this.peerConnection!.setLocalDescription(offer);\r\n    \r\n    signalingService.sendSignal({\r\n      type: 'offer',\r\n      payload: offer,\r\n      toRoom: roomCode,\r\n    });\r\n  }\r\n\r\n  async initializeAsReceiver(roomCode: string): Promise<void> {\r\n    this.roomCode = roomCode;\r\n    this.role = 'receiver';\r\n\r\n    await this.createPeerConnection();\r\n    this.setupDataChannelReceiver();\r\n  }\r\n\r\n  private async createPeerConnection(): Promise<void> {\r\n    this.peerConnection = new RTCPeerConnection(this.config);\r\n\r\n    this.peerConnection.onconnectionstatechange = () => {\r\n      const state = this.peerConnection!.connectionState;\r\n      console.log('Connection state changed:', state);\r\n      console.log('ICE connection state:', this.peerConnection!.iceConnectionState);\r\n      console.log('ICE gathering state:', this.peerConnection!.iceGatheringState);\r\n      this.onConnectionStateChange?.(state);\r\n      \r\n      if (state === 'failed') {\r\n        console.error('WebRTC connection failed');\r\n        this.onError?.('WebRTC connection failed');\r\n      }\r\n    };\r\n\r\n    this.peerConnection.onicecandidate = (event) => {\r\n      if (event.candidate) {\r\n        console.log('ICE candidate generated:', event.candidate.candidate);\r\n        signalingService.sendSignal({\r\n          type: 'ice',\r\n          payload: event.candidate,\r\n          toRoom: this.roomCode,\r\n        });\r\n      } else {\r\n        console.log('ICE gathering completed');\r\n      }\r\n    };\r\n\r\n    // Set up signaling message handler\r\n    signalingService.onSignal(this.handleSignalingMessage.bind(this));\r\n  }\r\n\r\n  private createDataChannel(): void {\r\n    console.log('Creating data channel...');\r\n    this.dataChannel = this.peerConnection!.createDataChannel('file-transfer', {\r\n      ordered: true,\r\n      maxRetransmits: 0,\r\n    });\r\n\r\n    this.dataChannel.binaryType = 'arraybuffer';\r\n    console.log('Data channel created with ID:', this.dataChannel.id);\r\n    this.setupDataChannelHandlers();\r\n  }\r\n\r\n  private setupDataChannelReceiver(): void {\r\n    this.peerConnection!.ondatachannel = (event) => {\r\n      this.dataChannel = event.channel;\r\n      this.dataChannel.binaryType = 'arraybuffer';\r\n      this.setupDataChannelHandlers();\r\n    };\r\n  }\r\n\r\n  private setupDataChannelHandlers(): void {\r\n    if (!this.dataChannel) return;\r\n\r\n    this.dataChannel.onopen = () => {\r\n      console.log('Data channel opened');\r\n      this.onDataChannelOpen?.();\r\n      \r\n      // Start file transfer if sender\r\n      if (this.role === 'sender' && this.currentFiles.length > 0) {\r\n        console.log('Data channel opened - starting file transfer as sender');\r\n        console.log('Files to transfer:', this.currentFiles.length);\r\n        this.startFileTransfer();\r\n      } else {\r\n        console.log('Data channel opened - role:', this.role, 'files:', this.currentFiles.length);\r\n      }\r\n    };\r\n\r\n    this.dataChannel.onclose = () => {\r\n      console.log('Data channel closed');\r\n      this.onDataChannelClose?.();\r\n    };\r\n\r\n    this.dataChannel.onerror = (error) => {\r\n      console.error('Data channel error:', error);\r\n      this.onError?.('Data channel error occurred');\r\n    };\r\n\r\n    this.dataChannel.onmessage = (event) => {\r\n      if (typeof event.data === 'string') {\r\n        this.handleTextMessage(JSON.parse(event.data));\r\n      } else {\r\n        this.handleBinaryData(event.data);\r\n      }\r\n    };\r\n  }\r\n\r\n  private async handleSignalingMessage(message: SignalingMessage): Promise<void> {\r\n    try {\r\n      switch (message.type) {\r\n        case 'offer':\r\n          if (this.role === 'receiver') {\r\n            await this.peerConnection!.setRemoteDescription(message.payload);\r\n            const answer = await this.peerConnection!.createAnswer();\r\n            await this.peerConnection!.setLocalDescription(answer);\r\n            \r\n            signalingService.sendSignal({\r\n              type: 'answer',\r\n              payload: answer,\r\n              toRoom: this.roomCode,\r\n            });\r\n          }\r\n          break;\r\n\r\n        case 'answer':\r\n          if (this.role === 'sender') {\r\n            await this.peerConnection!.setRemoteDescription(message.payload);\r\n          }\r\n          break;\r\n\r\n        case 'ice':\r\n          await this.peerConnection!.addIceCandidate(message.payload);\r\n          break;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error handling signaling message:', error);\r\n      this.onError?.('Failed to process signaling message');\r\n    }\r\n  }\r\n\r\n  private async startFileTransfer(): Promise<void> {\r\n    console.log('startFileTransfer called');\r\n    console.log('currentFiles:', this.currentFiles);\r\n    if (this.currentFiles.length === 0) {\r\n      console.log('No files to transfer');\r\n      return;\r\n    }\r\n\r\n    // Send file list to receiver first\r\n    const fileList: FileMetadata[] = this.currentFiles.map((file, index) => ({\r\n      name: file.name,\r\n      size: file.size,\r\n      type: file.type,\r\n      lastModified: file.lastModified,\r\n      fileIndex: index,\r\n    }));\r\n\r\n    if (this.dataChannel) {\r\n      this.dataChannel.send(JSON.stringify({\r\n        type: 'file-list',\r\n        data: fileList\r\n      }));\r\n    }\r\n\r\n    this.transferStartTime = Date.now();\r\n    this.currentFileIndex = 0;\r\n    \r\n    console.log('Starting transfer of first file:', this.currentFiles[0].name);\r\n    await this.sendFile(this.currentFiles[0]);\r\n  }\r\n\r\n  private async sendFile(file: File): Promise<void> {\r\n    console.log('sendFile called for:', file.name, 'size:', file.size);\r\n    \r\n    // Check if this file has been cancelled\r\n    if (this.cancelledFileIndices.has(this.currentFileIndex)) {\r\n      console.log('Skipping cancelled file:', file.name, 'at index:', this.currentFileIndex);\r\n      // Move to next file\r\n      this.currentFileIndex++;\r\n      if (this.currentFileIndex < this.currentFiles.length) {\r\n        console.log('Moving to next file after cancelled one...');\r\n        await this.sendFile(this.currentFiles[this.currentFileIndex]);\r\n      } else {\r\n        console.log('All files processed (some cancelled), sending completion signal');\r\n        this.sendTextMessage({ type: 'transfer-complete' });\r\n        this.onTransferComplete?.();\r\n      }\r\n      return;\r\n    }\r\n    \r\n    const metadata: FileMetadata = {\r\n      name: file.name,\r\n      size: file.size,\r\n      type: file.type,\r\n      lastModified: file.lastModified,\r\n      fileIndex: this.currentFileIndex,\r\n    };\r\n\r\n    console.log('Sending file metadata:', metadata);\r\n    // Send file metadata\r\n    this.sendTextMessage({\r\n      type: 'file-meta',\r\n      data: metadata,\r\n    });\r\n\r\n    console.log('Reading file as ArrayBuffer...');\r\n    // Send file data in chunks\r\n    const arrayBuffer = await file.arrayBuffer();\r\n    const totalChunks = Math.ceil(arrayBuffer.byteLength / this.chunkSize);\r\n    \r\n    console.log('File read successfully. Total chunks:', totalChunks);\r\n    \r\n    for (let i = 0; i < totalChunks; i++) {\r\n      // Check if file was cancelled during transfer\r\n      if (this.cancelledFileIndices.has(this.currentFileIndex)) {\r\n        console.log('File was cancelled during transfer, stopping current file only:', file.name);\r\n        // Just stop this file, don't try to move to next file automatically\r\n        // Let the natural flow handle the next file\r\n        return;\r\n      }\r\n      \r\n      const start = i * this.chunkSize;\r\n      const end = Math.min(start + this.chunkSize, arrayBuffer.byteLength);\r\n      const chunk = arrayBuffer.slice(start, end);\r\n      \r\n      console.log(`Preparing chunk ${i + 1}/${totalChunks}, size: ${chunk.byteLength}`);\r\n      console.log(`Current buffer amount: ${this.dataChannel!.bufferedAmount}`);\r\n      \r\n      // Wait for buffer to be available with timeout\r\n      let attempts = 0;\r\n      const maxAttempts = 1000; // 10 seconds timeout (original setting)\r\n      while (this.dataChannel!.bufferedAmount > this.maxBufferSize && attempts < maxAttempts) {\r\n        console.log(`Waiting for buffer to clear... (${this.dataChannel!.bufferedAmount}/${this.maxBufferSize})`);\r\n        await new Promise(resolve => setTimeout(resolve, 10)); // Original 10ms timing\r\n        attempts++;\r\n      }\r\n      \r\n      if (attempts >= maxAttempts) {\r\n        console.error('Buffer timeout - transfer may have failed');\r\n        this.onError?.('Transfer timeout - data channel buffer full');\r\n        return;\r\n      }\r\n      \r\n      try {\r\n        console.log(`Sending chunk ${i + 1}/${totalChunks}`);\r\n        this.dataChannel!.send(chunk);\r\n        console.log(`Chunk ${i + 1} sent successfully`);\r\n        \r\n        // Add small delay between chunks to prevent overwhelming\r\n        if (i < totalChunks - 1) {\r\n          await new Promise(resolve => setTimeout(resolve, 1)); // Back to original 1ms delay\r\n        }\r\n      } catch (error) {\r\n        console.error(`Error sending chunk ${i + 1}:`, error);\r\n        return;\r\n      }\r\n      \r\n      // Report progress\r\n      const progress = ((i + 1) / totalChunks) * 100;\r\n      const speed = this.calculateSpeed(end);\r\n      \r\n      const progressData = {\r\n        fileName: file.name,\r\n        fileIndex: this.currentFileIndex,\r\n        progress,\r\n        bytesTransferred: end,\r\n        totalBytes: file.size,\r\n        speed,\r\n      };\r\n      \r\n      console.log(`Progress update - Progress: ${progress}%, Speed: ${speed} bytes/sec, Bytes: ${end}/${file.size}`);\r\n      \r\n      // Send progress to local callback\r\n      this.onTransferProgress?.(progressData);\r\n      \r\n      // Send progress sync to receiver (throttled to every 500ms or at completion)\r\n      const now = Date.now();\r\n      if (now - this.lastProgressSync > 500 || progress >= 100) {\r\n        this.sendTextMessage({\r\n          type: 'progress-sync',\r\n          data: progressData\r\n        });\r\n        this.lastProgressSync = now;\r\n      }\r\n    }\r\n\r\n    console.log('File transfer completed for:', file.name);\r\n    // Move to next file or complete transfer\r\n    this.currentFileIndex++;\r\n    if (this.currentFileIndex < this.currentFiles.length) {\r\n      console.log('Moving to next file...');\r\n      await this.sendFile(this.currentFiles[this.currentFileIndex]);\r\n    } else {\r\n      console.log('All files transferred, sending completion signal');\r\n      this.sendTextMessage({ type: 'transfer-complete' });\r\n      this.onTransferComplete?.();\r\n    }\r\n  }\r\n\r\n  private handleTextMessage(message: DataChannelMessage): void {\r\n    switch (message.type) {\r\n      case 'file-list':\r\n        const fileList = message.data as FileMetadata[];\r\n        console.log('Received file list:', fileList);\r\n        this.onIncomingFiles?.(fileList);\r\n        break;\r\n\r\n      case 'file-meta':\r\n        this.currentFileMeta = message.data as FileMetadata;\r\n        this.currentFileIndex = this.currentFileMeta.fileIndex; // Set the current file index from metadata\r\n        this.receiveBuffers = [];\r\n        this.receivedBytes = 0;\r\n        \r\n        // Set transfer start time for receiver when first file meta is received\r\n        if (this.transferStartTime === 0) {\r\n          this.transferStartTime = Date.now();\r\n        }\r\n        \r\n        if (this.currentFileMeta) {\r\n          console.log('Receiving file:', this.currentFileMeta.name, 'at index:', this.currentFileIndex);\r\n        }\r\n        break;\r\n\r\n      case 'transfer-complete':\r\n        this.onTransferComplete?.();\r\n        break;\r\n\r\n      case 'transfer-cancelled':\r\n        const cancelData = message.data as { cancelledBy: 'sender' | 'receiver' };\r\n        this.onTransferCancelled?.(cancelData?.cancelledBy || 'peer');\r\n        break;\r\n\r\n      case 'file-cancelled':\r\n        const fileCancelData = message.data as { fileIndex: number; fileName: string; cancelledBy: 'sender' | 'receiver' };\r\n        console.log('File cancelled:', fileCancelData);\r\n        console.log('Received cancellation from:', fileCancelData.cancelledBy, 'My role is:', this.role);\r\n        \r\n        // Track the cancelled file\r\n        this.cancelledFileIndices.add(fileCancelData.fileIndex);\r\n        \r\n        // If this is the current file being received, stop receiving it\r\n        if (this.currentFileIndex === fileCancelData.fileIndex && this.currentFileMeta) {\r\n          console.log('Stopping current file reception due to cancellation');\r\n          this.currentFileMeta = null;\r\n          this.receiveBuffers = [];\r\n          this.receivedBytes = 0;\r\n        }\r\n        \r\n        this.onFileCancelled?.(fileCancelData);\r\n        break;\r\n\r\n      case 'progress-sync':\r\n        const progressData = message.data as FileTransferProgress;\r\n        console.log('Received progress sync from sender:', progressData);\r\n        this.onTransferProgress?.(progressData);\r\n        break;\r\n    }\r\n  }\r\n\r\n  private handleBinaryData(data: ArrayBuffer): void {\r\n    if (!this.currentFileMeta) {\r\n      console.log('Received binary data but no currentFileMeta - ignoring');\r\n      return;\r\n    }\r\n\r\n    this.receiveBuffers.push(data);\r\n    this.receivedBytes += data.byteLength;\r\n\r\n    console.log(`Chunk received: ${this.receivedBytes}/${this.currentFileMeta.size} bytes (${Math.round(this.receivedBytes/this.currentFileMeta.size*100)}%)`);\r\n\r\n    // Check if file is complete\r\n    if (this.receivedBytes >= this.currentFileMeta.size) {\r\n      console.log('=== FILE COMPLETE ===');\r\n      console.log('File name:', this.currentFileMeta.name);\r\n      console.log('File size:', this.currentFileMeta.size);\r\n      console.log('Bytes received:', this.receivedBytes);\r\n      console.log('Current file index:', this.currentFileIndex);\r\n      console.log('Cancelled indices:', Array.from(this.cancelledFileIndices));\r\n      \r\n      const blob = new Blob(this.receiveBuffers, { type: this.currentFileMeta.type });\r\n      console.log('Blob created - size:', blob.size);\r\n      \r\n      const file = new File([blob], this.currentFileMeta.name, {\r\n        type: this.currentFileMeta.type,\r\n        lastModified: this.currentFileMeta.lastModified,\r\n      });\r\n      console.log('File object created:', file.name, file.size);\r\n\r\n      // ALWAYS call onFileReceived - ignore cancellation for now\r\n      console.log('About to call onFileReceived...');\r\n      if (this.onFileReceived) {\r\n        this.onFileReceived(file);\r\n        console.log('onFileReceived called successfully');\r\n      } else {\r\n        console.error('onFileReceived callback is null/undefined!');\r\n      }\r\n      \r\n      // Reset for next file\r\n      this.currentFileMeta = null;\r\n      this.receiveBuffers = [];\r\n      this.receivedBytes = 0;\r\n    }\r\n  }\r\n\r\n  private sendTextMessage(message: DataChannelMessage): void {\r\n    console.log('sendTextMessage called:', message.type);\r\n    console.log('dataChannel state:', this.dataChannel?.readyState);\r\n    if (this.dataChannel?.readyState === 'open') {\r\n      console.log('Sending message via data channel:', message);\r\n      this.dataChannel.send(JSON.stringify(message));\r\n    } else {\r\n      console.log('Data channel not open, cannot send message');\r\n    }\r\n  }\r\n\r\n  private calculateSpeed(bytesTransferred: number): number {\r\n    if (this.transferStartTime === 0 || bytesTransferred === 0) {\r\n      return 0;\r\n    }\r\n    \r\n    const elapsed = (Date.now() - this.transferStartTime) / 1000;\r\n    const speed = elapsed > 0 ? bytesTransferred / elapsed : 0;\r\n    \r\n    // Return a valid number, avoid NaN or Infinity\r\n    return isFinite(speed) ? Math.max(0, speed) : 0;\r\n  }\r\n\r\n  cancelTransfer(): void {\r\n    if (this.role) {\r\n      this.sendTextMessage({\r\n        type: 'transfer-cancelled',\r\n        data: { cancelledBy: this.role },\r\n      });\r\n    }\r\n    \r\n    this.cleanup();\r\n  }\r\n\r\n  cancelFile(fileIndex: number, fileName: string): void {\r\n    console.log('Cancelling file:', fileName, 'at index:', fileIndex);\r\n    console.log('WebRTC service role when cancelling:', this.role);\r\n    \r\n    // Track cancelled file locally\r\n    this.cancelledFileIndices.add(fileIndex);\r\n    \r\n    if (this.role) {\r\n      console.log('Sending file cancellation message with role:', this.role);\r\n      this.sendTextMessage({\r\n        type: 'file-cancelled',\r\n        data: { \r\n          fileIndex, \r\n          fileName, \r\n          cancelledBy: this.role \r\n        },\r\n      });\r\n    } else {\r\n      console.log('No role set, cannot send cancellation message');\r\n    }\r\n  }\r\n\r\n  cleanup(): void {\r\n    if (this.dataChannel) {\r\n      this.dataChannel.close();\r\n      this.dataChannel = null;\r\n    }\r\n\r\n    if (this.peerConnection) {\r\n      this.peerConnection.close();\r\n      this.peerConnection = null;\r\n    }\r\n\r\n    signalingService.removeAllListeners();\r\n    \r\n    // Reset state\r\n    this.currentFiles = [];\r\n    this.receiveBuffers = [];\r\n    this.currentFileIndex = 0;\r\n    this.currentFileMeta = null;\r\n    this.transferStartTime = 0;\r\n    this.receivedBytes = 0;\r\n    this.lastProgressSync = 0;\r\n    this.cancelledFileIndices.clear(); // Clear cancelled files for new transfer\r\n    this.role = null;\r\n    this.roomCode = '';\r\n  }\r\n}\r\n\r\nexport const webrtcService = new WebRTCService();\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1005, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/shubh/Downloads/p2p-react/src/lib/file-utils.ts"],"sourcesContent":["export const formatFileSize = (bytes: number): string => {\r\n  if (bytes === 0) return '0 B';\r\n  \r\n  const k = 1024;\r\n  const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n  \r\n  const size = parseFloat((bytes / Math.pow(k, i)).toFixed(1));\r\n  \r\n  // Show appropriate precision based on size\r\n  if (i === 0) return `${bytes} ${sizes[i]}`; // Bytes - no decimal\r\n  if (i === 1 && size >= 100) return `${Math.round(size)} ${sizes[i]}`; // KB >= 100 - no decimal\r\n  if (i >= 2 && size >= 100) return `${Math.round(size)} ${sizes[i]}`; // MB/GB >= 100 - no decimal\r\n  \r\n  return `${size} ${sizes[i]}`;\r\n};\r\n\r\nexport const generateRoomCode = (): string => {\r\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\r\n  let result = '';\r\n  for (let i = 0; i < 8; i++) {\r\n    result += chars.charAt(Math.floor(Math.random() * chars.length));\r\n  }\r\n  return result;\r\n};\r\n\r\nexport const downloadFile = (file: File): void => {\r\n  console.log('downloadFile called with:', file.name, file.size, 'bytes');\r\n  \r\n  try {\r\n    // Create URL for the file\r\n    const url = URL.createObjectURL(file);\r\n    console.log('Created object URL:', url);\r\n    \r\n    // Create download link\r\n    const link = document.createElement('a');\r\n    link.href = url;\r\n    link.download = file.name;\r\n    \r\n    // Make sure the download attribute is properly set\r\n    if (!link.download) {\r\n      console.error('Download attribute not supported or not set properly');\r\n      // Fallback: try to open in new window\r\n      window.open(url, '_blank');\r\n      return;\r\n    }\r\n    \r\n    console.log('Created download link - href:', link.href, 'download:', link.download);\r\n    \r\n    // Style the link to be invisible but present\r\n    link.style.position = 'fixed';\r\n    link.style.top = '-1000px';\r\n    link.style.left = '-1000px';\r\n    link.style.visibility = 'hidden';\r\n    \r\n    // Add to document\r\n    document.body.appendChild(link);\r\n    console.log('Link added to document body');\r\n    \r\n    // Force the download\r\n    if (typeof link.click === 'function') {\r\n      link.click();\r\n      console.log('Link clicked successfully');\r\n    } else {\r\n      // Fallback for older browsers\r\n      const event = document.createEvent('MouseEvents');\r\n      event.initEvent('click', true, true);\r\n      link.dispatchEvent(event);\r\n      console.log('Click event dispatched');\r\n    }\r\n    \r\n    // Clean up after a delay\r\n    setTimeout(() => {\r\n      try {\r\n        if (document.body.contains(link)) {\r\n          document.body.removeChild(link);\r\n        }\r\n        URL.revokeObjectURL(url);\r\n        console.log('Cleanup completed successfully');\r\n      } catch (cleanupError) {\r\n        console.warn('Cleanup error (non-critical):', cleanupError);\r\n      }\r\n    }, 200);\r\n    \r\n  } catch (error) {\r\n    console.error('Download failed:', error);\r\n    \r\n    // Last resort: try to open the file in a new tab\r\n    try {\r\n      const url = URL.createObjectURL(file);\r\n      const newWindow = window.open(url, '_blank');\r\n      if (newWindow) {\r\n        console.log('Opened file in new window as fallback');\r\n      } else {\r\n        console.error('Failed to open file - popup blocker may be active');\r\n      }\r\n    } catch (fallbackError) {\r\n      console.error('All download methods failed:', fallbackError);\r\n    }\r\n  }\r\n};\r\n\r\nexport const debounce = <T extends (...args: any[]) => any>(\r\n  func: T,\r\n  wait: number\r\n): ((...args: Parameters<T>) => void) => {\r\n  let timeout: NodeJS.Timeout;\r\n  return (...args: Parameters<T>) => {\r\n    clearTimeout(timeout);\r\n    timeout = setTimeout(() => func(...args), wait);\r\n  };\r\n};\r\n\r\nexport const calculateTransferSpeed = (\r\n  bytesTransferred: number,\r\n  startTime: number\r\n): number => {\r\n  const elapsed = (Date.now() - startTime) / 1000; // seconds\r\n  return elapsed > 0 ? bytesTransferred / elapsed : 0;\r\n};\r\n\r\nexport const estimateTimeRemaining = (\r\n  bytesTransferred: number,\r\n  totalBytes: number,\r\n  speed: number\r\n): number => {\r\n  if (speed === 0) return Infinity;\r\n  const remainingBytes = totalBytes - bytesTransferred;\r\n  return remainingBytes / speed;\r\n};\r\n\r\nexport const formatTime = (seconds: number): string => {\r\n  if (!isFinite(seconds)) return '∞';\r\n  \r\n  const hrs = Math.floor(seconds / 3600);\r\n  const mins = Math.floor((seconds % 3600) / 60);\r\n  const secs = Math.floor(seconds % 60);\r\n  \r\n  if (hrs > 0) return `${hrs}h ${mins}m`;\r\n  if (mins > 0) return `${mins}m ${secs}s`;\r\n  return `${secs}s`;\r\n};\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1142, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/shubh/Downloads/p2p-react/src/components/ui/button.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60\",\n        outline:\n          \"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50\",\n        secondary:\n          \"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80\",\n        ghost:\n          \"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-9 px-4 py-2 has-[>svg]:px-3\",\n        sm: \"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5\",\n        lg: \"h-10 rounded-md px-6 has-[>svg]:px-4\",\n        icon: \"size-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction Button({\n  className,\n  variant,\n  size,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> &\n  VariantProps<typeof buttonVariants> & {\n    asChild?: boolean\n  }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"button\"\n      className={cn(buttonVariants({ variant, size, className }))}\n      {...props}\n    />\n  )\n}\n\nexport { Button, buttonVariants }\n"],"names":[],"mappings":";;;;;AACA;AACA;AAEA;;;;;AAEA,MAAM,iBAAiB,CAAA,GAAA,mKAAA,CAAA,MAAG,AAAD,EACvB,+bACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,aACE;YACF,SACE;YACF,WACE;YACF,OACE;YACF,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;QACR;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AAGF,SAAS,OAAO,KASb;QATa,EACd,SAAS,EACT,OAAO,EACP,IAAI,EACJ,UAAU,KAAK,EACf,GAAG,OAIF,GATa;IAUd,MAAM,OAAO,UAAU,mKAAA,CAAA,OAAI,GAAG;IAE9B,qBACE,6LAAC;QACC,aAAU;QACV,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EAAE,eAAe;YAAE;YAAS;YAAM;QAAU;QACvD,GAAG,KAAK;;;;;;AAGf;KAnBS","debugId":null}},
    {"offset": {"line": 1206, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/shubh/Downloads/p2p-react/src/components/SendFilesPanel.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useRef, useCallback, useEffect } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card, CardContent } from '@/components/ui/card';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Upload, FileText, Trash2, QrCode } from 'lucide-react';\r\nimport QRCode from 'qrcode';\r\n\r\nimport { formatFileSize } from '@/lib/file-utils';\r\n\r\ninterface SendFilesPanelProps {\r\n  onSendFiles: (files: File[]) => void;\r\n  disabled: boolean;\r\n  roomCode: string;\r\n}\r\n\r\nexport default function SendFilesPanel({ onSendFiles, disabled, roomCode }: SendFilesPanelProps) {\r\n  const [selectedFiles, setSelectedFiles] = useState<File[]>([]);\r\n  // Start with empty QR code\r\n  const [qrCodeUrl, setQrCodeUrl] = useState<string>('');\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  console.log('SendFilesPanel rendering, roomCode:', roomCode, 'qrCodeUrl:', qrCodeUrl ? 'HAS_VALUE' : 'EMPTY');\r\n\r\n  // Test QR code generation immediately\r\n  useEffect(() => {\r\n    // Always generate a test QR code to verify rendering works\r\n    const generateTestQR = async () => {\r\n      try {\r\n        console.log('Generating test QR code...');\r\n        const testQrUrl = await QRCode.toDataURL('https://example.com');\r\n        console.log('Test QR generated, length:', testQrUrl.length);\r\n        setQrCodeUrl(testQrUrl);\r\n      } catch (error) {\r\n        console.error('Test QR generation failed:', error);\r\n      }\r\n    };\r\n    generateTestQR();\r\n  }, []);\r\n\r\n  // Generate QR code when room code changes\r\n  useEffect(() => {\r\n    console.log('=== QR EFFECT RUNNING ===', 'roomCode:', roomCode);\r\n    if (roomCode) {\r\n      console.log('Room code exists, generating QR...');\r\n      const generateQR = async () => {\r\n        try {\r\n          const shareUrl = `${window.location.origin}?receive=${roomCode}`;\r\n          console.log('Generating QR for URL:', shareUrl);\r\n          const qrDataUrl = await QRCode.toDataURL(shareUrl, {\r\n            width: 256,\r\n            margin: 2,\r\n            color: {\r\n              dark: '#000000',\r\n              light: '#FFFFFF'\r\n            }\r\n          });\r\n          console.log('QR generated successfully! Length:', qrDataUrl.length);\r\n          setQrCodeUrl(qrDataUrl);\r\n          console.log('QR code state updated');\r\n        } catch (error) {\r\n          console.error('QR generation failed:', error);\r\n        }\r\n      };\r\n      generateQR();\r\n    } else {\r\n      console.log('No room code, clearing QR');\r\n      setQrCodeUrl('');\r\n    }\r\n  }, [roomCode]);\r\n\r\n  const handleFileSelect = useCallback((event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const files = Array.from(event.target.files || []);\r\n    if (files.length > 0) {\r\n      setSelectedFiles(files);\r\n    }\r\n  }, []);\r\n\r\n  const handleDrop = useCallback((event: React.DragEvent) => {\r\n    event.preventDefault();\r\n    const files = Array.from(event.dataTransfer.files);\r\n    if (files.length > 0) {\r\n      setSelectedFiles(files);\r\n    }\r\n  }, []);\r\n\r\n  const handleDragOver = useCallback((event: React.DragEvent) => {\r\n    event.preventDefault();\r\n  }, []);\r\n\r\n  const removeFile = useCallback((index: number) => {\r\n    setSelectedFiles(prev => prev.filter((_, i) => i !== index));\r\n  }, []);\r\n\r\n  const generateQRCode = useCallback(async () => {\r\n    if (!roomCode) return;\r\n    \r\n    try {\r\n      const shareUrl = `${window.location.origin}?receive=${roomCode}`;\r\n      const qrDataUrl = await QRCode.toDataURL(shareUrl, {\r\n        width: 256,\r\n        margin: 2,\r\n        color: {\r\n          dark: '#000000',\r\n          light: '#FFFFFF'\r\n        }\r\n      });\r\n      setQrCodeUrl(qrDataUrl);\r\n    } catch (error) {\r\n      console.error('Manual QR generation failed:', error);\r\n    }\r\n  }, [roomCode]);\r\n\r\n  const handleSendFiles = useCallback(() => {\r\n    console.log('handleSendFiles called with:', selectedFiles.length, 'files');\r\n    console.log('disabled:', disabled);\r\n    if (selectedFiles.length > 0) {\r\n      console.log('Calling onSendFiles with files:', selectedFiles);\r\n      onSendFiles(selectedFiles);\r\n    } else {\r\n      console.log('No files selected');\r\n    }\r\n  }, [selectedFiles, onSendFiles, disabled]);\r\n\r\n  const totalSize = selectedFiles.reduce((sum, file) => sum + file.size, 0);\r\n\r\n  if (roomCode) {\r\n    console.log('Rendering room code section - roomCode:', roomCode, 'qrCodeUrl:', qrCodeUrl || 'EMPTY');\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <Card className=\"border-green-200 bg-green-50/50 dark:border-green-800 dark:bg-green-950/50\">\r\n          <CardContent className=\"p-6\">\r\n            <div className=\"text-center space-y-4\">\r\n              <div className=\"p-3 mx-auto w-fit rounded-full bg-green-100 dark:bg-green-900\">\r\n                <QrCode className=\"h-6 w-6 text-green-600 dark:text-green-400\" />\r\n              </div>\r\n              <div>\r\n                <h3 className=\"text-lg font-semibold text-green-900 dark:text-green-100\">\r\n                  Share Room Created!\r\n                </h3>\r\n                <p className=\"text-sm text-green-700 dark:text-green-300\">\r\n                  Share this code with the receiver\r\n                </p>\r\n              </div>\r\n              \r\n              <div className=\"space-y-3\">\r\n                <div className=\"p-4 bg-white dark:bg-gray-900 rounded-lg border\">\r\n                  <div className=\"font-mono text-2xl font-bold text-center tracking-widest\">\r\n                    {roomCode}\r\n                  </div>\r\n                </div>\r\n                \r\n                {qrCodeUrl ? (\r\n                  <div className=\"flex justify-center\">\r\n                    <img \r\n                      src={qrCodeUrl} \r\n                      alt=\"QR Code\" \r\n                      width={256} \r\n                      height={256} \r\n                      className=\"rounded-lg border\" \r\n                    />\r\n                  </div>\r\n                ) : (\r\n                  <Button onClick={generateQRCode} variant=\"outline\" size=\"sm\">\r\n                    <QrCode className=\"h-4 w-4 mr-2\" />\r\n                    Generate QR Code\r\n                  </Button>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardContent className=\"p-6\">\r\n            <h4 className=\"text-lg font-semibold mb-4\">Files to Send:</h4>\r\n            <div className=\"space-y-2\">\r\n              {selectedFiles.map((file, index) => (\r\n                <div key={index} className=\"flex items-center justify-between p-3 bg-muted/50 rounded-lg\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <FileText className=\"h-4 w-4 text-muted-foreground\" />\r\n                    <div>\r\n                      <div className=\"font-medium\">{file.name}</div>\r\n                      <div className=\"text-sm text-muted-foreground\">{formatFileSize(file.size)}</div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n            \r\n            <div className=\"mt-4 pt-4 border-t\">\r\n              <div className=\"flex items-center justify-between text-sm\">\r\n                <span className=\"font-medium\">Total:</span>\r\n                <span>{selectedFiles.length} files, {formatFileSize(totalSize)}</span>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6 animate-in fade-in duration-300\">\r\n      <div\r\n        className=\"border-2 border-dashed border-muted-foreground/25 rounded-lg p-8 text-center hover:border-muted-foreground/50 transition-colors cursor-pointer bg-gradient-to-br from-background to-muted/20\"\r\n        onDrop={handleDrop}\r\n        onDragOver={handleDragOver}\r\n        onClick={() => fileInputRef.current?.click()}\r\n      >\r\n        <div className=\"space-y-4\">\r\n          <div className=\"p-4 mx-auto w-fit rounded-full bg-primary/10\">\r\n            <Upload className=\"h-8 w-8 text-primary\" />\r\n          </div>\r\n          <div>\r\n            <p className=\"text-lg font-medium\">Choose files to share</p>\r\n            <p className=\"text-sm text-muted-foreground\">\r\n              Drop files here or click to browse\r\n            </p>\r\n          </div>\r\n        </div>\r\n        \r\n        <input\r\n          ref={fileInputRef}\r\n          type=\"file\"\r\n          multiple\r\n          onChange={handleFileSelect}\r\n          className=\"hidden\"\r\n        />\r\n      </div>\r\n\r\n      {selectedFiles.length > 0 && (\r\n        <Card>\r\n          <CardContent className=\"p-6\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <h4 className=\"text-lg font-semibold\">Selected Files</h4>\r\n              <Badge variant=\"secondary\">\r\n                {selectedFiles.length} files\r\n              </Badge>\r\n            </div>\r\n            \r\n            <div className=\"space-y-2 max-h-60 overflow-y-auto\">\r\n              {selectedFiles.map((file, index) => (\r\n                <div key={index} className=\"flex items-center justify-between p-3 bg-muted/50 rounded-lg\">\r\n                  <div className=\"flex items-center gap-3 flex-1 min-w-0\">\r\n                    <FileText className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" />\r\n                    <div className=\"min-w-0 flex-1\">\r\n                      <div className=\"font-medium truncate\">{file.name}</div>\r\n                      <div className=\"text-sm text-muted-foreground\">{formatFileSize(file.size)}</div>\r\n                    </div>\r\n                  </div>\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    onClick={() => removeFile(index)}\r\n                    className=\"flex-shrink-0\"\r\n                  >\r\n                    <Trash2 className=\"h-4 w-4\" />\r\n                  </Button>\r\n                </div>\r\n              ))}\r\n            </div>\r\n            \r\n            <div className=\"mt-4 pt-4 border-t space-y-4\">\r\n              <div className=\"flex items-center justify-between text-sm\">\r\n                <span className=\"font-medium\">Total:</span>\r\n                <span>{selectedFiles.length} files, {formatFileSize(totalSize)}</span>\r\n              </div>\r\n              \r\n              <Button\r\n                onClick={handleSendFiles}\r\n                disabled={disabled}\r\n                className=\"w-full bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600\"\r\n                size=\"lg\"\r\n              >\r\n                <Upload className=\"h-4 w-4 mr-2\" />\r\n                Start Sharing\r\n              </Button>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1877, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/shubh/Downloads/p2p-react/src/components/ui/input.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Input({ className, type, ...props }: React.ComponentProps<\"input\">) {\n  return (\n    <input\n      type={type}\n      data-slot=\"input\"\n      className={cn(\n        \"file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        \"focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]\",\n        \"aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Input }\n"],"names":[],"mappings":";;;;AAEA;;;AAEA,SAAS,MAAM,KAA4D;QAA5D,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,OAAsC,GAA5D;IACb,qBACE,6LAAC;QACC,MAAM;QACN,aAAU;QACV,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,mcACA,iFACA,0GACA;QAED,GAAG,KAAK;;;;;;AAGf;KAdS","debugId":null}},
    {"offset": {"line": 1910, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/shubh/Downloads/p2p-react/src/components/ReceiveFilesPanel.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useCallback, useRef } from 'react';\r\nimport { useSearchParams } from 'next/navigation';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Card, CardContent } from '@/components/ui/card';\r\nimport { Download, QrCode, Camera, X } from 'lucide-react';\r\nimport { Scanner } from '@yudiel/react-qr-scanner';\r\n\r\ninterface ReceiveFilesPanelProps {\r\n  onReceiveFiles: (roomCode: string) => void;\r\n  disabled: boolean;\r\n}\r\n\r\nexport default function ReceiveFilesPanel({ onReceiveFiles, disabled }: ReceiveFilesPanelProps) {\r\n  console.log('=== ReceiveFilesPanel RENDERING ===');\r\n  \r\n  const searchParams = useSearchParams();\r\n  const receiveCode = searchParams.get('receive');\r\n  console.log('ReceiveFilesPanel detected receiveCode from searchParams:', receiveCode);\r\n  \r\n  const [roomCode, setRoomCode] = useState(receiveCode || '');\r\n  const [showScanner, setShowScanner] = useState(false);\r\n  const [hasAutoConnected, setHasAutoConnected] = useState(false);\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n\r\n  // Auto-connect when QR code parameter is detected - run immediately\r\n  if (receiveCode && !hasAutoConnected) {\r\n    console.log('QR code detected, auto-connecting to room:', receiveCode);\r\n    setHasAutoConnected(true);\r\n    // Auto-connect immediately\r\n    setTimeout(() => {\r\n      console.log('Auto-connecting now!');\r\n      onReceiveFiles(receiveCode.trim().toUpperCase());\r\n    }, 100);\r\n  }\r\n\r\n  const handleSubmit = useCallback((e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (roomCode.trim()) {\r\n      onReceiveFiles(roomCode.trim().toUpperCase());\r\n    }\r\n  }, [roomCode, onReceiveFiles]);\r\n\r\n  const handleScanSuccess = useCallback((detectedCodes: { rawValue: string }[]) => {\r\n    if (detectedCodes && detectedCodes.length > 0) {\r\n      const result = detectedCodes[0].rawValue;\r\n      console.log('QR scan result:', result);\r\n      \r\n      // Extract room code from URL or use direct code\r\n      let code = result;\r\n      try {\r\n        const url = new URL(result);\r\n        const receiveParam = url.searchParams.get('receive');\r\n        if (receiveParam) {\r\n          code = receiveParam;\r\n        }\r\n      } catch {\r\n        // Not a URL, use as direct code\r\n      }\r\n      \r\n      setRoomCode(code.toUpperCase());\r\n      setShowScanner(false);\r\n    }\r\n  }, []);\r\n\r\n  const handleScanError = useCallback((error: unknown) => {\r\n    console.error('QR scan error:', error);\r\n  }, []);\r\n\r\n  const formatRoomCode = (value: string) => {\r\n    return value.toUpperCase().replace(/[^A-Z0-9]/g, '').slice(0, 8);\r\n  };\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const formatted = formatRoomCode(e.target.value);\r\n    setRoomCode(formatted);\r\n  };\r\n\r\n  if (showScanner) {\r\n    return (\r\n      <Card>\r\n        <CardContent className=\"p-6\">\r\n          <div className=\"space-y-4\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <h3 className=\"text-lg font-semibold\">Scan QR Code</h3>\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                onClick={() => setShowScanner(false)}\r\n              >\r\n                <X className=\"h-4 w-4\" />\r\n              </Button>\r\n            </div>\r\n            \r\n            <div className=\"relative aspect-square max-w-sm mx-auto rounded-lg overflow-hidden bg-black\">\r\n              <Scanner\r\n                onScan={handleScanSuccess}\r\n                onError={handleScanError}\r\n                scanDelay={300}\r\n                constraints={{\r\n                  facingMode: 'environment'\r\n                }}\r\n              />\r\n              <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\r\n                <div className=\"w-48 h-48 border-2 border-white rounded-lg relative\">\r\n                  <div className=\"absolute top-0 left-0 w-6 h-6 border-t-4 border-l-4 border-blue-500 rounded-tl-lg\"></div>\r\n                  <div className=\"absolute top-0 right-0 w-6 h-6 border-t-4 border-r-4 border-blue-500 rounded-tr-lg\"></div>\r\n                  <div className=\"absolute bottom-0 left-0 w-6 h-6 border-b-4 border-l-4 border-blue-500 rounded-bl-lg\"></div>\r\n                  <div className=\"absolute bottom-0 right-0 w-6 h-6 border-b-4 border-r-4 border-blue-500 rounded-br-lg\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \r\n            <p className=\"text-sm text-muted-foreground text-center\">\r\n              Point your camera at the QR code to connect\r\n            </p>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6 animate-in fade-in duration-300\">\r\n      <Card className=\"bg-gradient-to-br from-background to-muted/20\">\r\n        <CardContent className=\"p-6\">\r\n          <div className=\"text-center space-y-4\">\r\n            <div className=\"p-4 mx-auto w-fit rounded-full bg-primary/10\">\r\n              <Download className=\"h-8 w-8 text-primary\" />\r\n            </div>\r\n            <div>\r\n              <h3 className=\"text-lg font-semibold\">Receive Files</h3>\r\n              <p className=\"text-sm text-muted-foreground\">\r\n                Enter the room code or scan QR code to connect\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n        <Card>\r\n          <CardContent className=\"p-6\">\r\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n              <div>\r\n                <label htmlFor=\"roomCode\" className=\"text-sm font-medium block mb-2\">\r\n                  Room Code\r\n                </label>\r\n                <Input\r\n                  ref={inputRef}\r\n                  id=\"roomCode\"\r\n                  type=\"text\"\r\n                  value={roomCode}\r\n                  onChange={handleInputChange}\r\n                  placeholder=\"Enter 8-digit code\"\r\n                  className=\"text-center font-mono text-lg tracking-widest\"\r\n                  maxLength={8}\r\n                />\r\n              </div>\r\n              \r\n              <Button\r\n                type=\"submit\"\r\n                disabled={disabled || roomCode.length !== 8}\r\n                className=\"w-full bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600\"\r\n                size=\"lg\"\r\n              >\r\n                <Download className=\"h-4 w-4 mr-2\" />\r\n                Connect\r\n              </Button>\r\n            </form>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardContent className=\"p-6\">\r\n            <div className=\"space-y-4\">\r\n              <div className=\"text-center\">\r\n                <QrCode className=\"h-12 w-12 mx-auto text-muted-foreground mb-2\" />\r\n                <h4 className=\"font-medium\">Scan QR Code</h4>\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  Use your camera to scan\r\n                </p>\r\n              </div>\r\n              \r\n              <Button\r\n                onClick={() => setShowScanner(true)}\r\n                variant=\"outline\"\r\n                className=\"w-full\"\r\n                size=\"lg\"\r\n              >\r\n                <Camera className=\"h-4 w-4 mr-2\" />\r\n                Open Scanner\r\n              </Button>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {roomCode && roomCode.length === 8 && (\r\n        <Card className=\"border-blue-200 bg-blue-50/50 dark:border-blue-800 dark:bg-blue-950/50\">\r\n          <CardContent className=\"p-4\">\r\n            <div className=\"text-center\">\r\n              <p className=\"text-sm text-blue-700 dark:text-blue-300\">\r\n                Ready to connect with room code: <span className=\"font-mono font-bold\">{roomCode}</span>\r\n              </p>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2414, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/shubh/Downloads/p2p-react/src/components/ui/progress.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Progress({\n  className,\n  value,\n  ...props\n}: React.ComponentProps<typeof ProgressPrimitive.Root>) {\n  return (\n    <ProgressPrimitive.Root\n      data-slot=\"progress\"\n      className={cn(\n        \"bg-primary/20 relative h-2 w-full overflow-hidden rounded-full\",\n        className\n      )}\n      {...props}\n    >\n      <ProgressPrimitive.Indicator\n        data-slot=\"progress-indicator\"\n        className=\"bg-primary h-full w-full flex-1 transition-all\"\n        style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n      />\n    </ProgressPrimitive.Root>\n  )\n}\n\nexport { Progress }\n"],"names":[],"mappings":";;;;AAGA;AAEA;AALA;;;;AAOA,SAAS,SAAS,KAIoC;QAJpC,EAChB,SAAS,EACT,KAAK,EACL,GAAG,OACiD,GAJpC;IAKhB,qBACE,6LAAC,uKAAA,CAAA,OAAsB;QACrB,aAAU;QACV,WAAW,CAAA,GAAA,sHAAA,CAAA,KAAE,AAAD,EACV,kEACA;QAED,GAAG,KAAK;kBAET,cAAA,6LAAC,uKAAA,CAAA,YAA2B;YAC1B,aAAU;YACV,WAAU;YACV,OAAO;gBAAE,WAAW,AAAC,eAAiC,OAAnB,MAAM,CAAC,SAAS,CAAC,GAAE;YAAI;;;;;;;;;;;AAIlE;KArBS","debugId":null}},
    {"offset": {"line": 2460, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/shubh/Downloads/p2p-react/src/components/TransferProgress.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { \r\n  CheckCircle, \r\n  XCircle, \r\n  Loader2, \r\n  Download, \r\n  FileText, \r\n  X,\r\n  RotateCcw,\r\n  Copy,\r\n  ArrowLeft\r\n} from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport QRCode from 'qrcode';\r\n\r\nimport { TransferState } from '@/types';\r\nimport { formatFileSize, formatTime, downloadFile } from '@/lib/file-utils';\r\n\r\ninterface TransferProgressProps {\r\n  transferState: TransferState;\r\n  roomCode: string;\r\n  receivedFiles: File[];\r\n  onCancel: () => void;\r\n  onReset: () => void;\r\n  onCancelFile?: (fileIndex: number) => void;\r\n}\r\n\r\nexport default function TransferProgress({\r\n  transferState,\r\n  roomCode,\r\n  receivedFiles,\r\n  onCancel,\r\n  onReset,\r\n  onCancelFile,\r\n}: TransferProgressProps) {\r\n  const [qrCodeUrl, setQrCodeUrl] = useState<string>('');\r\n  const isReceiver = receivedFiles.length > 0; // Simple check: if we have any received files, we're a receiver\r\n  \r\n  // Generate QR code when room code is available\r\n  useEffect(() => {\r\n    if (roomCode) {\r\n      const generateQR = async () => {\r\n        try {\r\n          const shareUrl = `${window.location.origin}${window.location.pathname}?receive=${roomCode}`;\r\n          const url = await QRCode.toDataURL(shareUrl, {\r\n            width: 200,\r\n            margin: 2,\r\n            color: {\r\n              dark: '#000000',\r\n              light: '#FFFFFF'\r\n            }\r\n          });\r\n          setQrCodeUrl(url);\r\n        } catch (error) {\r\n          console.error('Error generating QR code:', error);\r\n        }\r\n      };\r\n      generateQR();\r\n    }\r\n  }, [roomCode]);\r\n  \r\n  const copyRoomCode = async () => {\r\n    try {\r\n      // Try modern clipboard API first\r\n      if (navigator.clipboard && window.isSecureContext) {\r\n        await navigator.clipboard.writeText(roomCode);\r\n        toast.success('Room code copied to clipboard!');\r\n      } else {\r\n        // Fallback for mobile/older browsers\r\n        copyToClipboardFallback(roomCode);\r\n        toast.success('Room code copied to clipboard!');\r\n      }\r\n    } catch (error) {\r\n      // If clipboard API fails, use fallback\r\n      copyToClipboardFallback(roomCode);\r\n      toast.success('Room code copied to clipboard!');\r\n    }\r\n  };\r\n\r\n  const copyShareLink = async () => {\r\n    const shareUrl = `${window.location.origin}${window.location.pathname}?receive=${roomCode}`;\r\n    try {\r\n      // Try modern clipboard API first\r\n      if (navigator.clipboard && window.isSecureContext) {\r\n        await navigator.clipboard.writeText(shareUrl);\r\n        toast.success('Share link copied to clipboard!');\r\n      } else {\r\n        // Fallback for mobile/older browsers\r\n        copyToClipboardFallback(shareUrl);\r\n        toast.success('Share link copied to clipboard!');\r\n      }\r\n    } catch (error) {\r\n      // If clipboard API fails, use fallback\r\n      copyToClipboardFallback(shareUrl);\r\n      toast.success('Share link copied to clipboard!');\r\n    }\r\n  };\r\n\r\n  const copyToClipboardFallback = (text: string) => {\r\n    // Create a temporary textarea element\r\n    const textarea = document.createElement('textarea');\r\n    textarea.value = text;\r\n    textarea.style.position = 'fixed';\r\n    textarea.style.left = '-9999px';\r\n    textarea.style.top = '-9999px';\r\n    document.body.appendChild(textarea);\r\n    \r\n    // Select and copy the text\r\n    textarea.focus();\r\n    textarea.select();\r\n    \r\n    try {\r\n      document.execCommand('copy');\r\n    } catch (error) {\r\n      console.error('Fallback copy failed:', error);\r\n    }\r\n    \r\n    // Clean up\r\n    document.body.removeChild(textarea);\r\n  };\r\n\r\n  const downloadFileManual = (file: File) => {\r\n    try {\r\n      downloadFile(file);\r\n      toast.success(`Downloaded ${file.name}`);\r\n    } catch (error) {\r\n      console.error('Error downloading file:', error);\r\n      toast.error('Failed to download file');\r\n    }\r\n  };\r\n\r\n  const getStatusInfo = () => {\r\n    switch (transferState.status) {\r\n      case 'idle':\r\n        return {\r\n          icon: <XCircle className=\"h-6 w-6 text-gray-400\" />,\r\n          title: 'Ready to Transfer',\r\n          description: 'Waiting for connection',\r\n          color: 'gray'\r\n        };\r\n      case 'connecting':\r\n        return {\r\n          icon: <Loader2 className=\"h-6 w-6 animate-spin text-blue-500\" />,\r\n          title: 'Connecting...',\r\n          description: 'Establishing peer-to-peer connection',\r\n          color: 'blue'\r\n        };\r\n      case 'transferring':\r\n        return {\r\n          icon: <Loader2 className=\"h-6 w-6 animate-spin text-purple-500\" />,\r\n          title: 'Transferring Files',\r\n          description: 'Transfer in progress...',\r\n          color: 'purple'\r\n        };\r\n      case 'completed':\r\n        return {\r\n          icon: <CheckCircle className=\"h-6 w-6 text-green-500\" />,\r\n          title: 'Transfer Complete!',\r\n          description: 'All files transferred successfully',\r\n          color: 'green'\r\n        };\r\n      case 'error':\r\n        return {\r\n          icon: <XCircle className=\"h-6 w-6 text-red-500\" />,\r\n          title: 'Transfer Failed',\r\n          description: transferState.error || 'An error occurred during transfer',\r\n          color: 'red'\r\n        };\r\n      default:\r\n        return {\r\n          icon: <XCircle className=\"h-6 w-6 text-gray-400\" />,\r\n          title: 'Unknown Status',\r\n          description: 'Please try again',\r\n          color: 'gray'\r\n        };\r\n    }\r\n  };\r\n\r\n  const statusInfo = getStatusInfo();\r\n  const isTransferring = transferState.status === 'transferring';\r\n  const isComplete = transferState.status === 'completed';\r\n  const hasError = transferState.status === 'error';\r\n\r\n  return (\r\n    <>\r\n      <div className=\"space-y-6\">\r\n      {/* Room Code - Only show during initial connection phase */}\r\n      {(transferState.status === 'idle' || transferState.status === 'connecting') && (\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <h3 className=\"font-medium\">Room Code</h3>\r\n                <p className=\"text-2xl font-mono font-bold tracking-wider\">{roomCode}</p>\r\n              </div>\r\n              <div className=\"flex gap-2 flex-wrap\">\r\n                <Button onClick={copyRoomCode} variant=\"outline\" size=\"sm\">\r\n                  <Copy className=\"h-4 w-4 mr-2\" />\r\n                  Copy Code\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* QR Code - Always show for senders during initial connection phase */}\r\n      {!isReceiver && qrCodeUrl && (transferState.status === 'idle' || transferState.status === 'connecting') && (\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex flex-col items-center space-y-4\">\r\n              <h3 className=\"font-medium\">QR Code</h3>\r\n              <div className=\"flex flex-col items-center space-y-4\">\r\n                <img \r\n                  src={qrCodeUrl} \r\n                  alt=\"QR Code for sharing\" \r\n                  className=\"border rounded-lg\"\r\n                />\r\n                <p className=\"text-sm text-muted-foreground text-center\">\r\n                  Scan with receiver&apos;s device to connect\r\n                </p>\r\n                <Button onClick={copyShareLink} variant=\"outline\" size=\"sm\" className=\"w-full sm:w-auto\">\r\n                  <Copy className=\"h-4 w-4 mr-2\" />\r\n                  Copy Share Link\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Status */}\r\n      <Card>\r\n        <CardContent className=\"pt-6\">\r\n          <div className=\"flex items-center gap-4\">\r\n            {statusInfo.icon}\r\n            <div className=\"flex-1\">\r\n              <h3 className=\"font-medium text-lg\">{statusInfo.title}</h3>\r\n              <p className=\"text-muted-foreground\">{statusInfo.description}</p>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* File Transfer Queue */}\r\n      {transferState.files.length > 0 && (\r\n        <Card data-transfer-card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center justify-between\">\r\n              <span>File Transfer</span>\r\n              <Badge variant=\"secondary\">\r\n                {transferState.files.length} files\r\n              </Badge>\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"space-y-3\">\r\n              {transferState.files.map((file, index) => {\r\n                const progress = transferState.progress.find(p => p.fileIndex === index);\r\n                const isCurrentFile = progress && progress.progress < 100 && isTransferring && !progress.cancelled;\r\n                const isCompleted = isComplete || (progress && progress.progress >= 100 && !progress.cancelled);\r\n                const isFileComplete = progress && progress.progress >= 100 && !progress.cancelled; // Individual file completion\r\n                const isCancelled = progress?.cancelled;\r\n                const hasProgress = progress && progress.progress > 0 && !progress.cancelled;\r\n                const isPendingFile = isTransferring && !hasProgress && !isCancelled; // File waiting in queue\r\n                \r\n                return (\r\n                  <div key={index} data-file-item className=\"border rounded-lg p-4 space-y-3\">\r\n                    {/* File Info Header */}\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div className=\"flex items-center gap-3 flex-1 min-w-0\">\r\n                        <FileText className=\"h-5 w-5 text-muted-foreground flex-shrink-0\" />\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <div className=\"font-medium truncate\">{file.name}</div>\r\n                          <div className=\"text-sm text-muted-foreground\">\r\n                            {/* Use progress.totalBytes if file.size is 0 (for receivers) */}\r\n                            {formatFileSize(file.size || (progress?.totalBytes || 0))}\r\n                            {isCancelled ? (\r\n                              <> • Transfer cancelled</>\r\n                            ) : isFileComplete ? (\r\n                              <> • Transfer completed</>\r\n                            ) : hasProgress && progress ? (\r\n                              <> • {formatFileSize(progress.bytesTransferred)} transferring</>\r\n                            ) : null}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                      \r\n                      {/* Action Buttons */}\r\n                      <div className=\"flex items-center gap-2 flex-shrink-0\">\r\n                        {/* Speed and ETA for current file */}\r\n                        {hasProgress && progress && progress.progress < 100 && (\r\n                          <div className=\"text-right text-xs text-muted-foreground mr-2\">\r\n                            <div>\r\n                              {progress.speed && progress.speed > 0 \r\n                                ? formatFileSize(progress.speed) + '/s' \r\n                                : 'Calculating...'}\r\n                            </div>\r\n                            <div>\r\n                              {progress.speed && progress.speed > 0 && progress.totalBytes \r\n                                ? formatTime((progress.totalBytes - progress.bytesTransferred) / progress.speed)\r\n                                : 'ETA: Calculating...'\r\n                              }\r\n                            </div>\r\n                          </div>\r\n                        )}\r\n                        \r\n                        {/* Status Icons and Buttons */}\r\n                        {isCancelled ? (\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <XCircle className=\"h-5 w-5 text-red-500\" />\r\n                            <Badge variant=\"destructive\" className=\"text-xs\">\r\n                              Cancelled by {progress?.cancelledBy}\r\n                            </Badge>\r\n                          </div>\r\n                        ) : isFileComplete ? (\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <CheckCircle className=\"h-5 w-5 text-green-500\" />\r\n                            {/* Show download button immediately when individual file completes on receiver side */}\r\n                            {isReceiver && (\r\n                              <Button\r\n                                variant=\"outline\"\r\n                                size=\"sm\"\r\n                                onClick={() => {\r\n                                  // Try to find the received file first\r\n                                  const receivedFile = receivedFiles.find(rf => rf.name === file.name && rf.size === file.size);\r\n                                  if (receivedFile) {\r\n                                    downloadFileManual(receivedFile);\r\n                                  } else {\r\n                                    // If file not found in receivedFiles, create a dummy file for download\r\n                                    const dummyBlob = new Blob(['File data not available'], { type: 'text/plain' });\r\n                                    const dummyFile = new File([dummyBlob], file.name, { type: file.type || 'application/octet-stream' });\r\n                                    downloadFileManual(dummyFile);\r\n                                    toast.warning(`${file.name} downloaded as placeholder - original file data not available`);\r\n                                  }\r\n                                }}\r\n                              >\r\n                                <Download className=\"h-4 w-4\" />\r\n                              </Button>\r\n                            )}\r\n                          </div>\r\n                        ) : isCurrentFile ? (\r\n                          // Currently transferring file - only show spinner, NO cancel button\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Loader2 className=\"h-5 w-5 animate-spin text-blue-500\" />\r\n                          </div>\r\n                        ) : isPendingFile ? (\r\n                          // Pending files that haven't started yet - allow individual cancellation\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <div className=\"w-5 h-5 rounded-full bg-muted flex-shrink-0\" />\r\n                            {onCancelFile && (\r\n                              <Button\r\n                                variant=\"outline\"\r\n                                size=\"sm\"\r\n                                onClick={() => onCancelFile(index)}\r\n                                title=\"Remove from queue\"\r\n                              >\r\n                                <X className=\"h-4 w-4\" />\r\n                              </Button>\r\n                            )}\r\n                          </div>\r\n                        ) : (\r\n                          <div className=\"w-5 h-5 rounded-full bg-muted flex-shrink-0\" />\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    {/* Progress Bar - Don't show for cancelled files */}\r\n                    {!isCancelled && (hasProgress || isCompleted) && (\r\n                      <div className=\"space-y-1\">\r\n                        <Progress \r\n                          value={progress ? progress.progress : (isCompleted ? 100 : 0)} \r\n                          className=\"h-2\" \r\n                        />\r\n                        <div className=\"flex justify-between text-xs text-muted-foreground\">\r\n                          <span>{progress ? Math.round(progress.progress) : (isCompleted ? 100 : 0)}%</span>\r\n                          {progress && (\r\n                            <span>{formatFileSize(progress.bytesTransferred)} / {formatFileSize(progress.totalBytes)}</span>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n            \r\n            {/* Download All Button */}\r\n            {isReceiver && transferState.files.length > 1 && (() => {\r\n              const completedFiles = transferState.files.filter((file, index) => {\r\n                const progress = transferState.progress.find(p => p.fileIndex === index);\r\n                return progress && progress.progress >= 100 && !progress.cancelled;\r\n              });\r\n              \r\n              return completedFiles.length > 1 ? (\r\n                <div className=\"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\r\n                  <Button\r\n                    onClick={() => {\r\n                      let downloadedCount = 0;\r\n                      completedFiles.forEach(file => {\r\n                        const receivedFile = receivedFiles.find(rf => rf.name === file.name && rf.size === file.size);\r\n                        if (receivedFile) {\r\n                          downloadFileManual(receivedFile);\r\n                          downloadedCount++;\r\n                        }\r\n                      });\r\n                      \r\n                      if (downloadedCount > 0) {\r\n                        toast.success(`Downloaded ${downloadedCount} files`);\r\n                      } else {\r\n                        toast.error('No files available for download');\r\n                      }\r\n                    }}\r\n                    className=\"w-full\"\r\n                  >\r\n                    <Download className=\"h-4 w-4 mr-2\" />\r\n                    Download All ({completedFiles.length} files)\r\n                  </Button>\r\n                </div>\r\n              ) : null;\r\n            })()}\r\n            \r\n            {/* Action Buttons at Bottom */}\r\n            <div className=\"mt-6 flex gap-3\">\r\n              {hasError ? (\r\n                <Button onClick={onReset} variant=\"outline\" className=\"flex-1\">\r\n                  <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n                  Back to Main\r\n                </Button>\r\n              ) : isTransferring ? (\r\n                <Button onClick={onCancel} variant=\"outline\" className=\"flex-1\">\r\n                  <X className=\"h-4 w-4 mr-2\" />\r\n                  Cancel Transfer\r\n                </Button>\r\n              ) : (\r\n                <Button onClick={onReset} variant=\"outline\" className=\"flex-1\">\r\n                  <RotateCcw className=\"h-4 w-4 mr-2\" />\r\n                  New Transfer\r\n                </Button>\r\n              )}\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n      </div>\r\n    </>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3355, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/shubh/Downloads/p2p-react/src/components/P2PFileTransfer.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { useSearchParams } from 'next/navigation';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\nimport { Upload, Download, Wifi, WifiOff, Zap } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\n\r\nimport { TransferState } from '@/types';\r\nimport { signalingService } from '@/lib/signaling';\r\nimport { webrtcService } from '@/lib/webrtc';\r\nimport { generateRoomCode } from '@/lib/file-utils';\r\n\r\nimport SendFilesPanel from './SendFilesPanel';\r\nimport ReceiveFilesPanel from './ReceiveFilesPanel';\r\nimport TransferProgress from './TransferProgress';\r\n\r\nexport default function P2PFileTransfer() {\r\n  console.log('=== P2PFileTransfer COMPONENT RENDERING ===');\r\n  \r\n  const searchParams = useSearchParams();\r\n  const receiveCode = searchParams.get('receive');\r\n  console.log('Next.js searchParams receive:', receiveCode);\r\n  \r\n  const [isConnected, setIsConnected] = useState(false);\r\n  const [activeTab, setActiveTab] = useState<'send' | 'receive'>(receiveCode ? 'receive' : 'send');\r\n  console.log('Current activeTab in render:', activeTab);\r\n  const [transferState, setTransferState] = useState<TransferState>({\r\n    status: 'idle',\r\n    files: [],\r\n    progress: [],\r\n  });\r\n  \r\n  const [roomCode, setRoomCode] = useState('');\r\n  const [receivedFiles, setReceivedFiles] = useState<File[]>([]);\r\n  const [hasNavigatedToSharing, setHasNavigatedToSharing] = useState(false);\r\n\r\n  // Define handleReset first since other functions depend on it\r\n  const handleReset = useCallback(() => {\r\n    webrtcService.cleanup();\r\n    setRoomCode('');\r\n    setReceivedFiles([]);\r\n    setTransferState({\r\n      status: 'idle',\r\n      files: [],\r\n      progress: [],\r\n    });\r\n    setHasNavigatedToSharing(false);\r\n    \r\n    // Remove any query parameters and reset to main state\r\n    if (typeof window !== 'undefined') {\r\n      const url = new URL(window.location.href);\r\n      url.search = '';\r\n      window.history.replaceState({}, '', url.toString());\r\n    }\r\n  }, []);\r\n\r\n  // Auto-switch to receive tab when QR code URL is detected (client-side only)\r\n  useEffect(() => {\r\n    console.log('=== SIMPLE useEffect TEST ===');\r\n  }, []);\r\n\r\n  // Auto-switch to receive tab when QR code URL is detected (client-side only)\r\n  useEffect(() => {\r\n    console.log('=== useEffect running ===');\r\n    console.log('typeof window:', typeof window);\r\n    console.log('window.location:', typeof window !== 'undefined' ? window.location : 'undefined');\r\n    console.log('window.location.search:', typeof window !== 'undefined' ? window.location.search : 'undefined');\r\n    console.log('window.location.href:', typeof window !== 'undefined' ? window.location.href : 'undefined');\r\n    \r\n    if (typeof window !== 'undefined') {\r\n      const urlParams = new URLSearchParams(window.location.search);\r\n      const receiveCode = urlParams.get('receive');\r\n      console.log('receiveCode from URL:', receiveCode);\r\n      \r\n      if (receiveCode) {\r\n        console.log('QR code URL detected, switching to receive tab');\r\n        setActiveTab('receive');\r\n        setHasNavigatedToSharing(true);\r\n        \r\n        // Set up initial browser history state for receiver\r\n        window.history.replaceState({ receiving: true, roomCode: receiveCode }, '', window.location.href);\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  // Initialize signaling connection\r\n  useEffect(() => {\r\n    const connectToSignaling = async () => {\r\n      try {\r\n        console.log('Attempting to connect to signaling server...');\r\n        console.log('Current connection state:', signalingService.isConnected());\r\n        \r\n        // Add a small delay to avoid rapid connection attempts\r\n        await new Promise(resolve => setTimeout(resolve, 500));\r\n        \r\n        await signalingService.connect();\r\n        console.log('Successfully connected to signaling server');\r\n        setIsConnected(true);\r\n        toast.success('Connected to signaling server');\r\n      } catch (error) {\r\n        console.error('Failed to connect to signaling server:', error);\r\n        toast.error(`Failed to connect to server: ${error}`);\r\n        setIsConnected(false);\r\n        \r\n        // Retry connection after a delay\r\n        setTimeout(() => {\r\n          console.log('Retrying connection...');\r\n          connectToSignaling();\r\n        }, 2000);\r\n      }\r\n    };\r\n\r\n    connectToSignaling();\r\n\r\n    // Set up signaling event handlers\r\n    signalingService.onRoomFull((data) => {\r\n      toast.error(`Room ${data.room} is full! Only 2 people can share files at once.`);\r\n      setTransferState(prev => ({ ...prev, status: 'error', error: 'Room is full' }));\r\n    });\r\n\r\n    signalingService.onRoomBusy((data) => {\r\n      toast.error(`Room ${data.room} is currently transferring files. Please try again later.`);\r\n      setTransferState(prev => ({ ...prev, status: 'error', error: 'Room is busy' }));\r\n    });\r\n\r\n    signalingService.onRoomExpired(() => {\r\n      toast.error('This share session has expired. Please create a new one.');\r\n      handleReset();\r\n    });\r\n\r\n    signalingService.onPeerDisconnected((peerId) => {\r\n      console.log('Peer disconnected:', peerId);\r\n      toast.warning('Peer disconnected');\r\n      handleReset();\r\n    });\r\n\r\n    return () => {\r\n      webrtcService.cleanup();\r\n      signalingService.disconnect();\r\n    };\r\n  }, [handleReset]);\r\n\r\n  // Handle browser back button\r\n  useEffect(() => {\r\n    const handlePopState = (event: PopStateEvent) => {\r\n      console.log('Browser back button pressed, current state:', { roomCode, hasNavigatedToSharing });\r\n      console.log('PopState event state:', event.state);\r\n      \r\n      // If we're in a sharing state (have room code) and user pressed back\r\n      if (roomCode || hasNavigatedToSharing) {\r\n        console.log('Resetting to main state due to back button');\r\n        \r\n        // Reset to main state\r\n        handleReset();\r\n        \r\n        // Ensure we stay on the current page without query parameters\r\n        const cleanUrl = new URL(window.location.href);\r\n        cleanUrl.search = '';\r\n        window.history.replaceState({}, '', cleanUrl.toString());\r\n      }\r\n    };\r\n\r\n    const handleBeforeUnload = (event: BeforeUnloadEvent) => {\r\n      // Only show warning if there's an active transfer\r\n      if (roomCode && (transferState.status === 'transferring' || transferState.status === 'connecting')) {\r\n        event.preventDefault();\r\n        event.returnValue = '';\r\n        return '';\r\n      }\r\n    };\r\n\r\n    // Add the event listeners\r\n    window.addEventListener('popstate', handlePopState);\r\n    window.addEventListener('beforeunload', handleBeforeUnload);\r\n\r\n    // Cleanup\r\n    return () => {\r\n      window.removeEventListener('popstate', handlePopState);\r\n      window.removeEventListener('beforeunload', handleBeforeUnload);\r\n    };\r\n  }, [roomCode, hasNavigatedToSharing, handleReset, transferState.status]);\r\n\r\n  // Set up WebRTC event handlers\r\n  useEffect(() => {\r\n    webrtcService.onConnectionStateChange = (state) => {\r\n      console.log('WebRTC connection state:', state);\r\n      if (state === 'connected') {\r\n        setTransferState(prev => ({ ...prev, status: 'connecting' }));\r\n      } else if (state === 'failed' || state === 'disconnected') {\r\n        setTransferState(prev => ({ ...prev, status: 'error', error: 'Connection failed' }));\r\n      }\r\n    };\r\n\r\n    webrtcService.onDataChannelOpen = () => {\r\n      console.log('Data channel opened');\r\n      setTransferState(prev => ({ ...prev, status: 'transferring' }));\r\n    };\r\n\r\n    webrtcService.onIncomingFiles = (fileList) => {\r\n      console.log('Incoming files:', fileList);\r\n      \r\n      setTransferState(prev => ({\r\n        ...prev,\r\n        files: fileList, // Keep as FileMetadata[]\r\n        status: 'transferring'\r\n      }));\r\n    };\r\n\r\n    webrtcService.onTransferProgress = (progress) => {\r\n      setTransferState(prev => ({\r\n        ...prev,\r\n        progress: prev.progress.map(p => \r\n          p.fileIndex === progress.fileIndex ? {\r\n            fileIndex: progress.fileIndex,\r\n            fileName: progress.fileName,\r\n            progress: progress.progress,\r\n            speed: progress.speed,\r\n            bytesTransferred: progress.bytesTransferred,\r\n            totalBytes: progress.totalBytes,\r\n          } : p\r\n        ).concat(\r\n          prev.progress.find(p => p.fileIndex === progress.fileIndex) ? [] : [{\r\n            fileIndex: progress.fileIndex,\r\n            fileName: progress.fileName,\r\n            progress: progress.progress,\r\n            speed: progress.speed,\r\n            bytesTransferred: progress.bytesTransferred,\r\n            totalBytes: progress.totalBytes,\r\n          }]\r\n        )\r\n      }));\r\n    };\r\n\r\n    webrtcService.onFileReceived = (file) => {\r\n      console.log('onFileReceived called with file:', file.name, file.size, 'bytes');\r\n      setReceivedFiles(prev => [...prev, file]);\r\n      \r\n      // Show success notification without auto-download\r\n      toast.success(`File received: ${file.name}`, {\r\n        description: 'Click the download button to save the file',\r\n        duration: 5000,\r\n      });\r\n    };\r\n\r\n    webrtcService.onTransferComplete = () => {\r\n      setTransferState(prev => ({ ...prev, status: 'completed' }));\r\n      toast.success('Transfer completed successfully!');\r\n    };\r\n\r\n    webrtcService.onTransferCancelled = (cancelledBy) => {\r\n      toast.warning(`Transfer cancelled by ${cancelledBy}`);\r\n      setTransferState(prev => ({ \r\n        ...prev, \r\n        status: 'error',\r\n        error: `Transfer cancelled by ${cancelledBy}`\r\n      }));\r\n    };\r\n\r\n    webrtcService.onFileCancelled = (data) => {\r\n      toast.warning(`File \"${data.fileName}\" cancelled by ${data.cancelledBy}`);\r\n      // Mark the file as cancelled in progress instead of removing it\r\n      setTransferState(prev => ({\r\n        ...prev,\r\n        progress: [\r\n          ...prev.progress.filter(p => p.fileIndex !== data.fileIndex),\r\n          {\r\n            fileIndex: data.fileIndex,\r\n            fileName: data.fileName,\r\n            progress: 0,\r\n            speed: 0,\r\n            bytesTransferred: 0,\r\n            totalBytes: 0,\r\n            cancelled: true,\r\n            cancelledBy: data.cancelledBy\r\n          }\r\n        ]\r\n      }));\r\n    };\r\n\r\n    webrtcService.onError = (error) => {\r\n      toast.error(error);\r\n      setTransferState(prev => ({ ...prev, status: 'error', error }));\r\n    };\r\n  }, [handleReset]);\r\n\r\n  const handleCancelFile = useCallback((fileIndex: number) => {\r\n    const file = transferState.files[fileIndex];\r\n    if (!file) return;\r\n    \r\n    // Send cancellation message to peer\r\n    webrtcService.cancelFile(fileIndex, file.name);\r\n    \r\n    // Mark the file as cancelled locally\r\n    setTransferState(prev => ({\r\n      ...prev,\r\n      progress: [\r\n        ...prev.progress.filter(p => p.fileIndex !== fileIndex),\r\n        {\r\n          fileIndex,\r\n          fileName: file.name,\r\n          progress: 0,\r\n          speed: 0,\r\n          bytesTransferred: 0,\r\n          totalBytes: file.size,\r\n          cancelled: true,\r\n          cancelledBy: webrtcService.currentRole as 'sender' | 'receiver'\r\n        }\r\n      ]\r\n    }));\r\n    \r\n    toast.info(`File \"${file.name}\" cancelled`);\r\n  }, [transferState.files]);\r\n\r\n  const handleSendFiles = useCallback(async (files: File[]) => {\r\n    console.log('handleSendFiles called in main component');\r\n    console.log('isConnected:', isConnected);\r\n    console.log('files:', files);\r\n    \r\n    if (!isConnected) {\r\n      console.log('Not connected to signaling server');\r\n      toast.error('Not connected to signaling server');\r\n      return;\r\n    }\r\n\r\n    const code = generateRoomCode();\r\n    console.log('Generated room code:', code);\r\n    setRoomCode(code);\r\n    setHasNavigatedToSharing(true);\r\n    \r\n    // Create a browser history entry for the sharing state\r\n    const currentUrl = new URL(window.location.href);\r\n    currentUrl.searchParams.set('sharing', code);\r\n    window.history.pushState({ sharing: true, roomCode: code }, '', currentUrl.toString());\r\n    \r\n    setTransferState({\r\n      status: 'connecting',\r\n      files: files.map((f, index) => ({\r\n        name: f.name,\r\n        size: f.size,\r\n        type: f.type,\r\n        lastModified: f.lastModified,\r\n        fileIndex: index,\r\n      })),\r\n      progress: [],\r\n    });\r\n\r\n    // Scroll to top when sharing starts\r\n    window.scrollTo({ top: 0, behavior: 'smooth' });\r\n\r\n    try {\r\n      console.log('Joining room:', code);\r\n      signalingService.joinRoom(code);\r\n      \r\n      // Wait for peer to join\r\n      signalingService.onPeerJoined(async (peerId) => {\r\n        console.log('Peer joined:', peerId);\r\n        toast.success('Receiver connected! Starting transfer...');\r\n        await webrtcService.initializeAsSender(code, files);\r\n      });\r\n\r\n    } catch (error) {\r\n      console.error('Failed to initialize sender:', error);\r\n      toast.error('Failed to start file sharing');\r\n      handleReset();\r\n    }\r\n  }, [isConnected, handleReset]);\r\n\r\n  const handleReceiveFiles = useCallback(async (code: string) => {\r\n    if (!isConnected) {\r\n      toast.error('Not connected to signaling server');\r\n      return;\r\n    }\r\n\r\n    setRoomCode(code);\r\n    setHasNavigatedToSharing(true);\r\n    \r\n    // Create a browser history entry for the receiving state\r\n    const currentUrl = new URL(window.location.href);\r\n    if (!currentUrl.searchParams.has('receive')) {\r\n      currentUrl.searchParams.set('receive', code);\r\n      window.history.pushState({ receiving: true, roomCode: code }, '', currentUrl.toString());\r\n    }\r\n    \r\n    setTransferState({\r\n      status: 'connecting',\r\n      files: [],\r\n      progress: [],\r\n    });\r\n\r\n    try {\r\n      signalingService.joinRoom(code);\r\n      await webrtcService.initializeAsReceiver(code);\r\n      toast.success('Connected to sender. Waiting for files...');\r\n    } catch (error) {\r\n      console.error('Failed to initialize receiver:', error);\r\n      toast.error('Failed to join file sharing session');\r\n      handleReset();\r\n    }\r\n  }, [isConnected, handleReset]);\r\n\r\n  const handleCancelTransfer = useCallback(() => {\r\n    webrtcService.cancelTransfer();\r\n    handleReset();\r\n  }, [handleReset]);\r\n\r\n  return (\r\n    <div className=\"min-h-screen w-full relative\">\r\n      {/* Radial Gradient Background from Bottom */}\r\n      <div\r\n        className=\"absolute inset-0 z-0\"\r\n        style={{\r\n          background: \"radial-gradient(125% 125% at 50% 90%, #fff 40%, #6366f1 100%)\",\r\n        }}\r\n      />\r\n      {/* Your Content/Components */}\r\n      <div className=\"relative z-10 min-h-screen flex flex-col items-center justify-center p-6\">\r\n        <Card className=\"w-full max-w-2xl bg-background/80 backdrop-blur-xl border-white/20 shadow-2xl\">\r\n          <CardHeader className=\"text-center\">\r\n            <div className=\"flex items-center justify-center gap-3 mb-4\">\r\n              <div className=\"p-3 rounded-full bg-gradient-to-r from-blue-500 to-purple-500\">\r\n                <Zap className=\"h-6 w-6 text-white\" />\r\n              </div>\r\n              <div className=\"flex items-center gap-2\">\r\n                {isConnected ? (\r\n                  <Wifi className=\"h-5 w-5 text-green-500\" />\r\n                ) : (\r\n                  <WifiOff className=\"h-5 w-5 text-red-500\" />\r\n                )}\r\n                <Badge variant={isConnected ? 'default' : 'destructive'}>\r\n                  {isConnected ? 'Connected' : 'Disconnected'}\r\n                </Badge>\r\n              </div>\r\n            </div>\r\n            \r\n            <CardTitle className=\"text-4xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent leading-tight pb-2\">\r\n              Sendify\r\n            </CardTitle>\r\n            <CardDescription className=\"text-lg text-muted-foreground\">\r\n              Secure peer-to-peer file sharing\r\n            </CardDescription>\r\n          </CardHeader>\r\n\r\n          <CardContent>\r\n            {transferState.status === 'idle' ? (\r\n              <>\r\n                <Tabs value={activeTab} onValueChange={(value) => setActiveTab(value as 'send' | 'receive')} className=\"w-full\">\r\n                <TabsList className=\"grid w-full grid-cols-2\">\r\n                  <TabsTrigger value=\"send\" className=\"flex items-center gap-2 transition-all duration-200 ease-in-out\">\r\n                    <Upload className=\"h-4 w-4\" />\r\n                    Send Files\r\n                  </TabsTrigger>\r\n                  <TabsTrigger value=\"receive\" className=\"flex items-center gap-2 transition-all duration-200 ease-in-out\">\r\n                    <Download className=\"h-4 w-4\" />\r\n                    Receive Files\r\n                  </TabsTrigger>\r\n                </TabsList>\r\n\r\n                <TabsContent value=\"send\" className=\"mt-6 transition-all duration-300 ease-in-out\">\r\n                  <SendFilesPanel\r\n                    onSendFiles={handleSendFiles}\r\n                    disabled={!isConnected}\r\n                    roomCode={roomCode}\r\n                  />\r\n                </TabsContent>\r\n\r\n                <TabsContent value=\"receive\" className=\"mt-6 transition-all duration-300 ease-in-out\">\r\n                  <ReceiveFilesPanel\r\n                    onReceiveFiles={handleReceiveFiles}\r\n                    disabled={!isConnected}\r\n                  />\r\n                </TabsContent>\r\n              </Tabs>\r\n              </>\r\n            ) : (\r\n              <TransferProgress\r\n                transferState={transferState}\r\n                roomCode={roomCode}\r\n                receivedFiles={receivedFiles}\r\n                onCancel={handleCancelTransfer}\r\n                onReset={handleReset}\r\n                onCancelFile={handleCancelFile}\r\n              />\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n        \r\n        {/* Website Info */}\r\n        <div className=\"mt-6 w-full max-w-2xl text-center\">\r\n          <div className=\"text-black/80\">\r\n            <h3 className=\"text-lg font-semibold mb-2\">Sendify</h3>\r\n            <p className=\"text-sm text-black/70 mb-1\">\r\n              Secure, fast, and private peer-to-peer file sharing\r\n            </p>\r\n            <p className=\"text-sm text-black/70\">\r\n              No servers, no limits, direct device-to-device transfer\r\n            </p>\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Social Media Links - Outside the main card */}\r\n        <div className=\"mt-8 w-full max-w-2xl\">\r\n          <div className=\"flex flex-col sm:flex-row items-center justify-between gap-4 text-black/80\">\r\n            <div className=\"text-sm\">\r\n              Built with ❤️ for secure P2P file sharing\r\n            </div>\r\n            <div className=\"flex items-center gap-4\">\r\n              <a\r\n                href=\"https://github.com/10neWOlF\"\r\n                target=\"_blank\"\r\n                rel=\"noopener noreferrer\"\r\n                className=\"text-black/60 hover:text-black transition-colors\"\r\n                title=\"GitHub\"\r\n              >\r\n                <svg className=\"h-5 w-5\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path d=\"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z\"/>\r\n                </svg>\r\n              </a>\r\n              <a\r\n                href=\"https://x.com/ShubhamPardule\"\r\n                target=\"_blank\"\r\n                rel=\"noopener noreferrer\"\r\n                className=\"text-black/60 hover:text-black transition-colors\"\r\n                title=\"X (Twitter)\"\r\n              >\r\n                <svg className=\"h-5 w-5\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path d=\"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z\"/>\r\n                </svg>\r\n              </a>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 4250, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/shubh/Downloads/p2p-react/src/components/FloatingScrollButton.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { ChevronUp, ChevronDown } from 'lucide-react';\r\n\r\nexport default function FloatingScrollButton() {\r\n  const [scrollButtonState, setScrollButtonState] = useState<'top' | 'bottom'>('top');\r\n  const [showButton, setShowButton] = useState(false);\r\n  const [isVisible, setIsVisible] = useState(true);\r\n\r\n  // Check if there are enough files to show the button\r\n  useEffect(() => {\r\n    const checkForFiles = () => {\r\n      const transferCard = document.querySelector('[data-transfer-card]');\r\n      const fileElements = document.querySelectorAll('[data-transfer-card] [data-file-item]');\r\n      setShowButton(transferCard !== null && fileElements.length > 3);\r\n    };\r\n\r\n    // Check initially and on DOM changes\r\n    checkForFiles();\r\n    const observer = new MutationObserver(checkForFiles);\r\n    observer.observe(document.body, { childList: true, subtree: true });\r\n\r\n    return () => observer.disconnect();\r\n  }, []);\r\n\r\n  // Auto-hide after 3 seconds and show on user interaction\r\n  useEffect(() => {\r\n    let hideTimer: NodeJS.Timeout;\r\n\r\n    const hideButton = () => {\r\n      hideTimer = setTimeout(() => {\r\n        setIsVisible(false);\r\n      }, 3000);\r\n    };\r\n\r\n    const showButtonOnActivity = () => {\r\n      clearTimeout(hideTimer);\r\n      setIsVisible(true);\r\n      hideButton(); // Start new timer\r\n    };\r\n\r\n    // Start initial timer\r\n    hideButton();\r\n\r\n    // Listen for user activity\r\n    const events = ['scroll', 'mousemove', 'touchstart', 'touchmove', 'wheel'];\r\n    events.forEach(event => {\r\n      window.addEventListener(event, showButtonOnActivity, { passive: true });\r\n    });\r\n\r\n    return () => {\r\n      clearTimeout(hideTimer);\r\n      events.forEach(event => {\r\n        window.removeEventListener(event, showButtonOnActivity);\r\n      });\r\n    };\r\n  }, []);\r\n\r\n  const handleScrollButtonClick = () => {\r\n    if (scrollButtonState === 'top') {\r\n      // Scroll to very top of the page\r\n      window.scrollTo({ top: 0, behavior: 'smooth' });\r\n      setScrollButtonState('bottom');\r\n    } else {\r\n      // Scroll to bottom of the page\r\n      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });\r\n      setScrollButtonState('top');\r\n    }\r\n  };\r\n\r\n  const getScrollButtonIcon = () => {\r\n    switch (scrollButtonState) {\r\n      case 'top':\r\n        return <ChevronUp className=\"h-4 w-4\" />;\r\n      case 'bottom':\r\n        return <ChevronDown className=\"h-4 w-4\" />;\r\n    }\r\n  };\r\n\r\n  if (!showButton) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div \r\n      className={`fixed bottom-6 right-6 z-[9999] transition-opacity duration-300 ${\r\n        isVisible ? 'opacity-100' : 'opacity-0 pointer-events-none'\r\n      }`}\r\n    >\r\n      <Button\r\n        onClick={handleScrollButtonClick}\r\n        size=\"sm\"\r\n        className=\"rounded-full w-12 h-12 p-0 shadow-2xl backdrop-blur-md border-2 transition-all duration-300 hover:scale-110\"\r\n        variant=\"secondary\"\r\n        title={scrollButtonState === 'top' ? 'Scroll to top' : 'Scroll to bottom'}\r\n      >\r\n        {getScrollButtonIcon()}\r\n      </Button>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAAA;;;AAJA;;;;AAMe,SAAS;;IACtB,MAAM,CAAC,mBAAmB,qBAAqB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAoB;IAC7E,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAC7C,MAAM,CAAC,WAAW,aAAa,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAE3C,qDAAqD;IACrD,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;0CAAE;YACR,MAAM;gEAAgB;oBACpB,MAAM,eAAe,SAAS,aAAa,CAAC;oBAC5C,MAAM,eAAe,SAAS,gBAAgB,CAAC;oBAC/C,cAAc,iBAAiB,QAAQ,aAAa,MAAM,GAAG;gBAC/D;;YAEA,qCAAqC;YACrC;YACA,MAAM,WAAW,IAAI,iBAAiB;YACtC,SAAS,OAAO,CAAC,SAAS,IAAI,EAAE;gBAAE,WAAW;gBAAM,SAAS;YAAK;YAEjE;kDAAO,IAAM,SAAS,UAAU;;QAClC;yCAAG,EAAE;IAEL,yDAAyD;IACzD,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;0CAAE;YACR,IAAI;YAEJ,MAAM;6DAAa;oBACjB,YAAY;qEAAW;4BACrB,aAAa;wBACf;oEAAG;gBACL;;YAEA,MAAM;uEAAuB;oBAC3B,aAAa;oBACb,aAAa;oBACb,cAAc,kBAAkB;gBAClC;;YAEA,sBAAsB;YACtB;YAEA,2BAA2B;YAC3B,MAAM,SAAS;gBAAC;gBAAU;gBAAa;gBAAc;gBAAa;aAAQ;YAC1E,OAAO,OAAO;kDAAC,CAAA;oBACb,OAAO,gBAAgB,CAAC,OAAO,sBAAsB;wBAAE,SAAS;oBAAK;gBACvE;;YAEA;kDAAO;oBACL,aAAa;oBACb,OAAO,OAAO;0DAAC,CAAA;4BACb,OAAO,mBAAmB,CAAC,OAAO;wBACpC;;gBACF;;QACF;yCAAG,EAAE;IAEL,MAAM,0BAA0B;QAC9B,IAAI,sBAAsB,OAAO;YAC/B,iCAAiC;YACjC,OAAO,QAAQ,CAAC;gBAAE,KAAK;gBAAG,UAAU;YAAS;YAC7C,qBAAqB;QACvB,OAAO;YACL,+BAA+B;YAC/B,OAAO,QAAQ,CAAC;gBAAE,KAAK,SAAS,IAAI,CAAC,YAAY;gBAAE,UAAU;YAAS;YACtE,qBAAqB;QACvB;IACF;IAEA,MAAM,sBAAsB;QAC1B,OAAQ;YACN,KAAK;gBACH,qBAAO,6LAAC,mNAAA,CAAA,YAAS;oBAAC,WAAU;;;;;;YAC9B,KAAK;gBACH,qBAAO,6LAAC,uNAAA,CAAA,cAAW;oBAAC,WAAU;;;;;;QAClC;IACF;IAEA,IAAI,CAAC,YAAY;QACf,OAAO;IACT;IAEA,qBACE,6LAAC;QACC,WAAW,AAAC,mEAEX,OADC,YAAY,gBAAgB;kBAG9B,cAAA,6LAAC,qIAAA,CAAA,SAAM;YACL,SAAS;YACT,MAAK;YACL,WAAU;YACV,SAAQ;YACR,OAAO,sBAAsB,QAAQ,kBAAkB;sBAEtD;;;;;;;;;;;AAIT;GAhGwB;KAAA","debugId":null}}]
}