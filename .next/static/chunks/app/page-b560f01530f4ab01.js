(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{285:(e,t,s)=>{"use strict";s.d(t,{$:()=>i});var n=s(5155);s(2115);var r=s(9708),o=s(2085),a=s(9434);let l=(0,o.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function i(e){let{className:t,variant:s,size:o,asChild:i=!1,...c}=e,d=i?r.DX:"button";return(0,n.jsx)(d,{"data-slot":"button",className:(0,a.cn)(l({variant:s,size:o,className:t})),...c})}},387:(e,t,s)=>{Promise.resolve().then(s.bind(s,6671)),Promise.resolve().then(s.bind(s,2277)),Promise.resolve().then(s.bind(s,8967))},2277:(e,t,s)=>{"use strict";s.d(t,{default:()=>i});var n=s(5155),r=s(2115),o=s(285),a=s(7863),l=s(6474);function i(){let[e,t]=(0,r.useState)("top"),[s,i]=(0,r.useState)(!1),[c,d]=(0,r.useState)(!0);return((0,r.useEffect)(()=>{let e=()=>{let e=document.querySelector("[data-transfer-card]"),t=document.querySelectorAll("[data-transfer-card] [data-file-item]");i(null!==e&&t.length>3)};e();let t=new MutationObserver(e);return t.observe(document.body,{childList:!0,subtree:!0}),()=>t.disconnect()},[]),(0,r.useEffect)(()=>{let e,t=()=>{e=setTimeout(()=>{d(!1)},3e3)},s=()=>{clearTimeout(e),d(!0),t()};t();let n=["scroll","mousemove","touchstart","touchmove","wheel"];return n.forEach(e=>{window.addEventListener(e,s,{passive:!0})}),()=>{clearTimeout(e),n.forEach(e=>{window.removeEventListener(e,s)})}},[]),s)?(0,n.jsx)("div",{className:"fixed bottom-6 right-6 z-[9999] transition-opacity duration-300 ".concat(c?"opacity-100":"opacity-0 pointer-events-none"),children:(0,n.jsx)(o.$,{onClick:()=>{"top"===e?(window.scrollTo({top:0,behavior:"smooth"}),t("bottom")):(window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}),t("top"))},size:"sm",className:"rounded-full w-12 h-12 p-0 shadow-2xl backdrop-blur-md border-2 transition-all duration-300 hover:scale-110",variant:"secondary",title:"top"===e?"Scroll to top":"Scroll to bottom",children:(()=>{switch(e){case"top":return(0,n.jsx)(a.A,{className:"h-4 w-4"});case"bottom":return(0,n.jsx)(l.A,{className:"h-4 w-4"})}})()})}):null}},8967:(e,t,s)=>{"use strict";s.d(t,{default:()=>K});var n=s(5155),r=s(2115),o=s(5695),a=s(9434);function l(e){let{className:t,...s}=e;return(0,n.jsx)("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...s})}function i(e){let{className:t,...s}=e;return(0,n.jsx)("div",{"data-slot":"card-header",className:(0,a.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...s})}function c(e){let{className:t,...s}=e;return(0,n.jsx)("div",{"data-slot":"card-title",className:(0,a.cn)("leading-none font-semibold",t),...s})}function d(e){let{className:t,...s}=e;return(0,n.jsx)("div",{"data-slot":"card-description",className:(0,a.cn)("text-muted-foreground text-sm",t),...s})}function h(e){let{className:t,...s}=e;return(0,n.jsx)("div",{"data-slot":"card-content",className:(0,a.cn)("px-6",t),...s})}var u=s(9708);let m=(0,s(2085).F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function f(e){let{className:t,variant:s,asChild:r=!1,...o}=e,l=r?u.DX:"span";return(0,n.jsx)(l,{"data-slot":"badge",className:(0,a.cn)(m({variant:s}),t),...o})}var g=s(1482);function x(e){let{className:t,...s}=e;return(0,n.jsx)(g.bL,{"data-slot":"tabs",className:(0,a.cn)("flex flex-col gap-2",t),...s})}function p(e){let{className:t,...s}=e;return(0,n.jsx)(g.B8,{"data-slot":"tabs-list",className:(0,a.cn)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...s})}function v(e){let{className:t,...s}=e;return(0,n.jsx)(g.l9,{"data-slot":"tabs-trigger",className:(0,a.cn)("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...s})}function b(e){let{className:t,...s}=e;return(0,n.jsx)(g.UC,{"data-slot":"tabs-content",className:(0,a.cn)("flex-1 outline-none",t),...s})}var w=s(1539),y=s(8898),j=s(4449),N=s(9869),C=s(1788),k=s(6671),F=s(4298);class R{connect(e){return new Promise((t,s)=>{if(this.socket&&this.socket.connected){console.log("Already connected to signaling server:",this.socket.id),t(this.socket);return}if(this.socket&&this.socket.disconnect(),e)this.serverUrl=e;else{let e=window.location.hostname,t=window.location.protocol;console.log("Detected hostname:",e),console.log("Detected protocol:",t),"localhost"===e||"127.0.0.1"===e?this.serverUrl="http://localhost:3003":this.serverUrl="".concat(t,"//").concat(e,":3003")}console.log("Connecting to signaling server:",this.serverUrl),this.socket=(0,F.io)(this.serverUrl,{transports:["polling","websocket"],timeout:2e4,forceNew:!0,reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3,upgrade:!0,rememberUpgrade:!1}),this.socket.on("connect",()=>{var e;console.log("Connected to signaling server:",null==(e=this.socket)?void 0:e.id),t(this.socket)}),this.socket.on("connect_error",e=>{console.error("Signaling connection error:",e);let t="Connection failed";e.message?t=e.message:"string"==typeof e&&(t=e),s(Error("Connection failed: ".concat(t)))}),this.socket.on("disconnect",e=>{console.log("Disconnected from signaling server:",e)}),setTimeout(()=>{this.socket&&!this.socket.connected&&s(Error("Connection timeout after 20 seconds"))},2e4)})}isConnected(){return null!==this.socket&&this.socket.connected}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null)}joinRoom(e){this.socket&&this.socket.emit("join-room",e)}sendSignal(e){if(this.socket)switch(console.log("Sending signal:",e),e.type){case"offer":this.socket.emit("webrtc-offer",{roomId:e.toRoom,offer:e.payload});break;case"answer":this.socket.emit("webrtc-answer",{roomId:e.toRoom,answer:e.payload});break;case"ice":this.socket.emit("webrtc-ice-candidate",{roomId:e.toRoom,candidate:e.payload});break;default:console.warn("Unknown signal type:",e.type)}}onRoomFull(e){this.socket&&this.socket.on("room-full",e)}onRoomBusy(e){this.socket&&this.socket.on("room-busy",e)}onRoomExpired(e){this.socket&&this.socket.on("room-expired",e)}onPeerJoined(e){this.socket&&this.socket.on("peer-joined",e)}onPeerDisconnected(e){this.socket&&this.socket.on("peer-disconnected",e)}onSignal(e){this.socket&&(this.socket.on("webrtc-offer",t=>{console.log("Received WebRTC offer:",t),e({type:"offer",payload:t.offer,fromPeer:t.from,toRoom:""})}),this.socket.on("webrtc-answer",t=>{console.log("Received WebRTC answer:",t),e({type:"answer",payload:t.answer,fromPeer:t.from,toRoom:""})}),this.socket.on("webrtc-ice-candidate",t=>{console.log("Received WebRTC ICE candidate:",t),e({type:"ice",payload:t.candidate,fromPeer:t.from,toRoom:""})}))}removeAllListeners(){this.socket&&(this.socket.off("webrtc-offer"),this.socket.off("webrtc-answer"),this.socket.off("webrtc-ice-candidate"),this.socket.off("peer-joined"),this.socket.off("peer-disconnected"),this.socket.off("room-full"),this.socket.off("room-busy"),this.socket.off("room-expired"))}get id(){var e;return(null==(e=this.socket)?void 0:e.id)||null}get connected(){var e;return(null==(e=this.socket)?void 0:e.connected)||!1}constructor(){this.socket=null,this.serverUrl=""}}let S=new R;class T{get currentRole(){return this.role}async initializeAsSender(e,t){this.roomCode=e,this.role="sender",this.currentFiles=t,await this.createPeerConnection(),this.createDataChannel();let s=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(s),S.sendSignal({type:"offer",payload:s,toRoom:e})}async initializeAsReceiver(e){this.roomCode=e,this.role="receiver",await this.createPeerConnection(),this.setupDataChannelReceiver()}async createPeerConnection(){this.peerConnection=new RTCPeerConnection(this.config),this.peerConnection.onconnectionstatechange=()=>{var e,t;let s=this.peerConnection.connectionState;console.log("Connection state changed:",s),console.log("ICE connection state:",this.peerConnection.iceConnectionState),console.log("ICE gathering state:",this.peerConnection.iceGatheringState),null==(e=this.onConnectionStateChange)||e.call(this,s),"failed"===s&&(console.error("WebRTC connection failed"),null==(t=this.onError)||t.call(this,"WebRTC connection failed"))},this.peerConnection.onicecandidate=e=>{e.candidate?(console.log("ICE candidate generated:",e.candidate.candidate),S.sendSignal({type:"ice",payload:e.candidate,toRoom:this.roomCode})):console.log("ICE gathering completed")},S.onSignal(this.handleSignalingMessage.bind(this))}createDataChannel(){console.log("Creating data channel..."),this.dataChannel=this.peerConnection.createDataChannel("file-transfer",{ordered:!0,maxRetransmits:0}),this.dataChannel.binaryType="arraybuffer",console.log("Data channel created with ID:",this.dataChannel.id),this.setupDataChannelHandlers()}setupDataChannelReceiver(){this.peerConnection.ondatachannel=e=>{this.dataChannel=e.channel,this.dataChannel.binaryType="arraybuffer",this.setupDataChannelHandlers()}}setupDataChannelHandlers(){this.dataChannel&&(this.dataChannel.onopen=()=>{var e;console.log("Data channel opened"),null==(e=this.onDataChannelOpen)||e.call(this),"sender"===this.role&&this.currentFiles.length>0?(console.log("Data channel opened - starting file transfer as sender"),console.log("Files to transfer:",this.currentFiles.length),this.startFileTransfer()):console.log("Data channel opened - role:",this.role,"files:",this.currentFiles.length)},this.dataChannel.onclose=()=>{var e;console.log("Data channel closed"),null==(e=this.onDataChannelClose)||e.call(this)},this.dataChannel.onerror=e=>{var t;console.error("Data channel error:",e),null==(t=this.onError)||t.call(this,"Data channel error occurred")},this.dataChannel.onmessage=e=>{"string"==typeof e.data?this.handleTextMessage(JSON.parse(e.data)):this.handleBinaryData(e.data)})}async handleSignalingMessage(e){try{switch(e.type){case"offer":if("receiver"===this.role){await this.peerConnection.setRemoteDescription(e.payload);let t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t),S.sendSignal({type:"answer",payload:t,toRoom:this.roomCode})}break;case"answer":"sender"===this.role&&await this.peerConnection.setRemoteDescription(e.payload);break;case"ice":await this.peerConnection.addIceCandidate(e.payload)}}catch(e){var t;console.error("Error handling signaling message:",e),null==(t=this.onError)||t.call(this,"Failed to process signaling message")}}async startFileTransfer(){if(console.log("startFileTransfer called"),console.log("currentFiles:",this.currentFiles),0===this.currentFiles.length)return void console.log("No files to transfer");let e=this.currentFiles.map((e,t)=>({name:e.name,size:e.size,type:e.type,lastModified:e.lastModified,fileIndex:t}));this.dataChannel&&this.dataChannel.send(JSON.stringify({type:"file-list",data:e})),this.transferStartTime=Date.now(),this.currentFileIndex=0,console.log("Starting transfer of first file:",this.currentFiles[0].name),await this.sendFile(this.currentFiles[0])}async sendFile(e){var t,s,n,r;if(console.log("sendFile called for:",e.name,"size:",e.size),this.cancelledFileIndices.has(this.currentFileIndex)){console.log("Skipping cancelled file:",e.name,"at index:",this.currentFileIndex),this.currentFileIndex++,this.currentFileIndex<this.currentFiles.length?(console.log("Moving to next file after cancelled one..."),await this.sendFile(this.currentFiles[this.currentFileIndex])):(console.log("All files processed (some cancelled), sending completion signal"),this.sendTextMessage({type:"transfer-complete"}),null==(t=this.onTransferComplete)||t.call(this));return}let o={name:e.name,size:e.size,type:e.type,lastModified:e.lastModified,fileIndex:this.currentFileIndex};console.log("Sending file metadata:",o),this.sendTextMessage({type:"file-meta",data:o}),console.log("Reading file as ArrayBuffer...");let a=await e.arrayBuffer(),l=Math.ceil(a.byteLength/this.chunkSize);console.log("File read successfully. Total chunks:",l);for(let t=0;t<l;t++){if(this.cancelledFileIndices.has(this.currentFileIndex))return void console.log("File was cancelled during transfer, stopping current file only:",e.name);let r=t*this.chunkSize,o=Math.min(r+this.chunkSize,a.byteLength),i=a.slice(r,o);console.log("Preparing chunk ".concat(t+1,"/").concat(l,", size: ").concat(i.byteLength)),console.log("Current buffer amount: ".concat(this.dataChannel.bufferedAmount));let c=0;for(;this.dataChannel.bufferedAmount>this.maxBufferSize&&c<1e3;)console.log("Waiting for buffer to clear... (".concat(this.dataChannel.bufferedAmount,"/").concat(this.maxBufferSize,")")),await new Promise(e=>setTimeout(e,10)),c++;if(c>=1e3){console.error("Buffer timeout - transfer may have failed"),null==(n=this.onError)||n.call(this,"Transfer timeout - data channel buffer full");return}try{console.log("Sending chunk ".concat(t+1,"/").concat(l)),this.dataChannel.send(i),console.log("Chunk ".concat(t+1," sent successfully")),t<l-1&&await new Promise(e=>setTimeout(e,1))}catch(e){console.error("Error sending chunk ".concat(t+1,":"),e);return}let d=(t+1)/l*100,h=this.calculateSpeed(o),u={fileName:e.name,fileIndex:this.currentFileIndex,progress:d,bytesTransferred:o,totalBytes:e.size,speed:h};console.log("Progress update - Progress: ".concat(d,"%, Speed: ").concat(h," bytes/sec, Bytes: ").concat(o,"/").concat(e.size)),null==(s=this.onTransferProgress)||s.call(this,u);let m=Date.now();(m-this.lastProgressSync>500||d>=100)&&(this.sendTextMessage({type:"progress-sync",data:u}),this.lastProgressSync=m)}console.log("File transfer completed for:",e.name),this.currentFileIndex++,this.currentFileIndex<this.currentFiles.length?(console.log("Moving to next file..."),await this.sendFile(this.currentFiles[this.currentFileIndex])):(console.log("All files transferred, sending completion signal"),this.sendTextMessage({type:"transfer-complete"}),null==(r=this.onTransferComplete)||r.call(this))}handleTextMessage(e){var t,s,n,r,o;switch(e.type){case"file-list":let a=e.data;console.log("Received file list:",a),null==(t=this.onIncomingFiles)||t.call(this,a);break;case"file-meta":this.currentFileMeta=e.data,this.currentFileIndex=this.currentFileMeta.fileIndex,this.receiveBuffers=[],this.receivedBytes=0,0===this.transferStartTime&&(this.transferStartTime=Date.now()),this.currentFileMeta&&console.log("Receiving file:",this.currentFileMeta.name,"at index:",this.currentFileIndex);break;case"transfer-complete":null==(s=this.onTransferComplete)||s.call(this);break;case"transfer-cancelled":let l=e.data;null==(n=this.onTransferCancelled)||n.call(this,(null==l?void 0:l.cancelledBy)||"peer");break;case"file-cancelled":let i=e.data;console.log("File cancelled:",i),console.log("Received cancellation from:",i.cancelledBy,"My role is:",this.role),this.cancelledFileIndices.add(i.fileIndex),this.currentFileIndex===i.fileIndex&&this.currentFileMeta&&(console.log("Stopping current file reception due to cancellation"),this.currentFileMeta=null,this.receiveBuffers=[],this.receivedBytes=0),null==(r=this.onFileCancelled)||r.call(this,i);break;case"progress-sync":let c=e.data;console.log("Received progress sync from sender:",c),null==(o=this.onTransferProgress)||o.call(this,c)}}handleBinaryData(e){if(!this.currentFileMeta)return void console.log("Received binary data but no currentFileMeta - ignoring");if(this.receiveBuffers.push(e),this.receivedBytes+=e.byteLength,console.log("Chunk received: ".concat(this.receivedBytes,"/").concat(this.currentFileMeta.size," bytes (").concat(Math.round(this.receivedBytes/this.currentFileMeta.size*100),"%)")),this.receivedBytes>=this.currentFileMeta.size){console.log("=== FILE COMPLETE ==="),console.log("File name:",this.currentFileMeta.name),console.log("File size:",this.currentFileMeta.size),console.log("Bytes received:",this.receivedBytes),console.log("Current file index:",this.currentFileIndex),console.log("Cancelled indices:",Array.from(this.cancelledFileIndices));let e=new Blob(this.receiveBuffers,{type:this.currentFileMeta.type});console.log("Blob created - size:",e.size);let t=new File([e],this.currentFileMeta.name,{type:this.currentFileMeta.type,lastModified:this.currentFileMeta.lastModified});console.log("File object created:",t.name,t.size),console.log("About to call onFileReceived..."),this.onFileReceived?(this.onFileReceived(t),console.log("onFileReceived called successfully")):console.error("onFileReceived callback is null/undefined!"),this.currentFileMeta=null,this.receiveBuffers=[],this.receivedBytes=0}}sendTextMessage(e){var t,s;console.log("sendTextMessage called:",e.type),console.log("dataChannel state:",null==(t=this.dataChannel)?void 0:t.readyState),(null==(s=this.dataChannel)?void 0:s.readyState)==="open"?(console.log("Sending message via data channel:",e),this.dataChannel.send(JSON.stringify(e))):console.log("Data channel not open, cannot send message")}calculateSpeed(e){if(0===this.transferStartTime||0===e)return 0;let t=(Date.now()-this.transferStartTime)/1e3,s=t>0?e/t:0;return isFinite(s)?Math.max(0,s):0}cancelTransfer(){this.role&&this.sendTextMessage({type:"transfer-cancelled",data:{cancelledBy:this.role}}),this.cleanup()}cancelFile(e,t){console.log("Cancelling file:",t,"at index:",e),console.log("WebRTC service role when cancelling:",this.role),this.cancelledFileIndices.add(e),this.role?(console.log("Sending file cancellation message with role:",this.role),this.sendTextMessage({type:"file-cancelled",data:{fileIndex:e,fileName:t,cancelledBy:this.role}})):console.log("No role set, cannot send cancellation message")}cleanup(){this.dataChannel&&(this.dataChannel.close(),this.dataChannel=null),this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null),S.removeAllListeners(),this.currentFiles=[],this.receiveBuffers=[],this.currentFileIndex=0,this.currentFileMeta=null,this.transferStartTime=0,this.receivedBytes=0,this.lastProgressSync=0,this.cancelledFileIndices.clear(),this.role=null,this.roomCode=""}constructor(){this.peerConnection=null,this.dataChannel=null,this.roomCode="",this.role=null,this.config={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"}]},this.chunkSize=65536,this.maxBufferSize=8388608,this.currentFiles=[],this.receiveBuffers=[],this.currentFileIndex=0,this.currentFileMeta=null,this.transferStartTime=0,this.receivedBytes=0,this.lastProgressSync=0,this.cancelledFileIndices=new Set}}let M=new T,A=e=>{if(0===e)return"0 B";let t=["B","KB","MB","GB","TB"],s=Math.floor(Math.log(e)/Math.log(1024)),n=parseFloat((e/Math.pow(1024,s)).toFixed(1));return 0===s?"".concat(e," ").concat(t[s]):1===s&&n>=100||s>=2&&n>=100?"".concat(Math.round(n)," ").concat(t[s]):"".concat(n," ").concat(t[s])};var E=s(285),z=s(7939),I=s(7434),B=s(2525),D=s(6862);function P(e){let{onSendFiles:t,disabled:s,roomCode:o}=e,[a,i]=(0,r.useState)([]),[c,d]=(0,r.useState)(""),u=(0,r.useRef)(null);console.log("SendFilesPanel rendering, roomCode:",o,"qrCodeUrl:",c?"HAS_VALUE":"EMPTY"),(0,r.useEffect)(()=>{(async()=>{try{console.log("Generating test QR code...");let e=await D.toDataURL("https://example.com");console.log("Test QR generated, length:",e.length),d(e)}catch(e){console.error("Test QR generation failed:",e)}})()},[]),(0,r.useEffect)(()=>{console.log("=== QR EFFECT RUNNING ===","roomCode:",o),o?(console.log("Room code exists, generating QR..."),(async()=>{try{let e="".concat(window.location.origin,"?receive=").concat(o);console.log("Generating QR for URL:",e);let t=await D.toDataURL(e,{width:256,margin:2,color:{dark:"#000000",light:"#FFFFFF"}});console.log("QR generated successfully! Length:",t.length),d(t),console.log("QR code state updated")}catch(e){console.error("QR generation failed:",e)}})()):(console.log("No room code, clearing QR"),d(""))},[o]);let m=(0,r.useCallback)(e=>{let t=Array.from(e.target.files||[]);t.length>0&&i(t)},[]),g=(0,r.useCallback)(e=>{e.preventDefault();let t=Array.from(e.dataTransfer.files);t.length>0&&i(t)},[]),x=(0,r.useCallback)(e=>{e.preventDefault()},[]),p=(0,r.useCallback)(e=>{i(t=>t.filter((t,s)=>s!==e))},[]),v=(0,r.useCallback)(async()=>{if(o)try{let e="".concat(window.location.origin,"?receive=").concat(o),t=await D.toDataURL(e,{width:256,margin:2,color:{dark:"#000000",light:"#FFFFFF"}});d(t)}catch(e){console.error("Manual QR generation failed:",e)}},[o]),b=(0,r.useCallback)(()=>{console.log("handleSendFiles called with:",a.length,"files"),console.log("disabled:",s),a.length>0?(console.log("Calling onSendFiles with files:",a),t(a)):console.log("No files selected")},[a,t,s]),w=a.reduce((e,t)=>e+t.size,0);return o?(console.log("Rendering room code section - roomCode:",o,"qrCodeUrl:",c||"EMPTY"),(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsx)(l,{className:"border-green-200 bg-green-50/50 dark:border-green-800 dark:bg-green-950/50",children:(0,n.jsx)(h,{className:"p-6",children:(0,n.jsxs)("div",{className:"text-center space-y-4",children:[(0,n.jsx)("div",{className:"p-3 mx-auto w-fit rounded-full bg-green-100 dark:bg-green-900",children:(0,n.jsx)(z.A,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-green-900 dark:text-green-100",children:"Share Room Created!"}),(0,n.jsx)("p",{className:"text-sm text-green-700 dark:text-green-300",children:"Share this code with the receiver"})]}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("div",{className:"p-4 bg-white dark:bg-gray-900 rounded-lg border",children:(0,n.jsx)("div",{className:"font-mono text-2xl font-bold text-center tracking-widest",children:o})}),c?(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsx)("img",{src:c,alt:"QR Code",width:256,height:256,className:"rounded-lg border"})}):(0,n.jsxs)(E.$,{onClick:v,variant:"outline",size:"sm",children:[(0,n.jsx)(z.A,{className:"h-4 w-4 mr-2"}),"Generate QR Code"]})]})]})})}),(0,n.jsx)(l,{children:(0,n.jsxs)(h,{className:"p-6",children:[(0,n.jsx)("h4",{className:"text-lg font-semibold mb-4",children:"Files to Send:"}),(0,n.jsx)("div",{className:"space-y-2",children:a.map((e,t)=>(0,n.jsx)("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)(I.A,{className:"h-4 w-4 text-muted-foreground"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"font-medium",children:e.name}),(0,n.jsx)("div",{className:"text-sm text-muted-foreground",children:A(e.size)})]})]})},t))}),(0,n.jsx)("div",{className:"mt-4 pt-4 border-t",children:(0,n.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,n.jsx)("span",{className:"font-medium",children:"Total:"}),(0,n.jsxs)("span",{children:[a.length," files, ",A(w)]})]})})]})})]})):(0,n.jsxs)("div",{className:"space-y-6 animate-in fade-in duration-300",children:[(0,n.jsxs)("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-8 text-center hover:border-muted-foreground/50 transition-colors cursor-pointer bg-gradient-to-br from-background to-muted/20",onDrop:g,onDragOver:x,onClick:()=>{var e;return null==(e=u.current)?void 0:e.click()},children:[(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("div",{className:"p-4 mx-auto w-fit rounded-full bg-primary/10",children:(0,n.jsx)(N.A,{className:"h-8 w-8 text-primary"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-lg font-medium",children:"Choose files to share"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"Drop files here or click to browse"})]})]}),(0,n.jsx)("input",{ref:u,type:"file",multiple:!0,onChange:m,className:"hidden"})]}),a.length>0&&(0,n.jsx)(l,{children:(0,n.jsxs)(h,{className:"p-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsx)("h4",{className:"text-lg font-semibold",children:"Selected Files"}),(0,n.jsxs)(f,{variant:"secondary",children:[a.length," files"]})]}),(0,n.jsx)("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:a.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(0,n.jsx)(I.A,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),(0,n.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,n.jsx)("div",{className:"font-medium truncate",children:e.name}),(0,n.jsx)("div",{className:"text-sm text-muted-foreground",children:A(e.size)})]})]}),(0,n.jsx)(E.$,{variant:"ghost",size:"sm",onClick:()=>p(t),className:"flex-shrink-0",children:(0,n.jsx)(B.A,{className:"h-4 w-4"})})]},t))}),(0,n.jsxs)("div",{className:"mt-4 pt-4 border-t space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,n.jsx)("span",{className:"font-medium",children:"Total:"}),(0,n.jsxs)("span",{children:[a.length," files, ",A(w)]})]}),(0,n.jsxs)(E.$,{onClick:b,disabled:s,className:"w-full bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600",size:"lg",children:[(0,n.jsx)(N.A,{className:"h-4 w-4 mr-2"}),"Start Sharing"]})]})]})})]})}function L(e){let{className:t,type:s,...r}=e;return(0,n.jsx)("input",{type:s,"data-slot":"input",className:(0,a.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...r})}var U=s(4416),Q=s(4355),O=s(2352);function _(e){let{onReceiveFiles:t,disabled:s}=e;console.log("=== ReceiveFilesPanel RENDERING ===");let a=(0,o.useSearchParams)().get("receive");console.log("ReceiveFilesPanel detected receiveCode from searchParams:",a);let[i,c]=(0,r.useState)(a||""),[d,u]=(0,r.useState)(!1),[m,f]=(0,r.useState)(!1),g=(0,r.useRef)(null);a&&!m&&(console.log("QR code detected, auto-connecting to room:",a),f(!0),setTimeout(()=>{console.log("Auto-connecting now!"),t(a.trim().toUpperCase())},100));let x=(0,r.useCallback)(e=>{e.preventDefault(),i.trim()&&t(i.trim().toUpperCase())},[i,t]),p=(0,r.useCallback)(e=>{if(e&&e.length>0){let t=e[0].rawValue;console.log("QR scan result:",t);let s=t;try{let e=new URL(t).searchParams.get("receive");e&&(s=e)}catch(e){}c(s.toUpperCase()),u(!1)}},[]),v=(0,r.useCallback)(e=>{console.error("QR scan error:",e)},[]);return d?(0,n.jsx)(l,{children:(0,n.jsx)(h,{className:"p-6",children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold",children:"Scan QR Code"}),(0,n.jsx)(E.$,{variant:"ghost",size:"sm",onClick:()=>u(!1),children:(0,n.jsx)(U.A,{className:"h-4 w-4"})})]}),(0,n.jsxs)("div",{className:"relative aspect-square max-w-sm mx-auto rounded-lg overflow-hidden bg-black",children:[(0,n.jsx)(O.Lp,{onScan:p,onError:v,scanDelay:300,constraints:{facingMode:"environment"}}),(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,n.jsxs)("div",{className:"w-48 h-48 border-2 border-white rounded-lg relative",children:[(0,n.jsx)("div",{className:"absolute top-0 left-0 w-6 h-6 border-t-4 border-l-4 border-blue-500 rounded-tl-lg"}),(0,n.jsx)("div",{className:"absolute top-0 right-0 w-6 h-6 border-t-4 border-r-4 border-blue-500 rounded-tr-lg"}),(0,n.jsx)("div",{className:"absolute bottom-0 left-0 w-6 h-6 border-b-4 border-l-4 border-blue-500 rounded-bl-lg"}),(0,n.jsx)("div",{className:"absolute bottom-0 right-0 w-6 h-6 border-b-4 border-r-4 border-blue-500 rounded-br-lg"})]})})]}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground text-center",children:"Point your camera at the QR code to connect"})]})})}):(0,n.jsxs)("div",{className:"space-y-6 animate-in fade-in duration-300",children:[(0,n.jsx)(l,{className:"bg-gradient-to-br from-background to-muted/20",children:(0,n.jsx)(h,{className:"p-6",children:(0,n.jsxs)("div",{className:"text-center space-y-4",children:[(0,n.jsx)("div",{className:"p-4 mx-auto w-fit rounded-full bg-primary/10",children:(0,n.jsx)(C.A,{className:"h-8 w-8 text-primary"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold",children:"Receive Files"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"Enter the room code or scan QR code to connect"})]})]})})}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsx)(l,{children:(0,n.jsx)(h,{className:"p-6",children:(0,n.jsxs)("form",{onSubmit:x,className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"roomCode",className:"text-sm font-medium block mb-2",children:"Room Code"}),(0,n.jsx)(L,{ref:g,id:"roomCode",type:"text",value:i,onChange:e=>{c(e.target.value.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,8))},placeholder:"Enter 8-digit code",className:"text-center font-mono text-lg tracking-widest",maxLength:8})]}),(0,n.jsxs)(E.$,{type:"submit",disabled:s||8!==i.length,className:"w-full bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600",size:"lg",children:[(0,n.jsx)(C.A,{className:"h-4 w-4 mr-2"}),"Connect"]})]})})}),(0,n.jsx)(l,{children:(0,n.jsx)(h,{className:"p-6",children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(z.A,{className:"h-12 w-12 mx-auto text-muted-foreground mb-2"}),(0,n.jsx)("h4",{className:"font-medium",children:"Scan QR Code"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"Use your camera to scan"})]}),(0,n.jsxs)(E.$,{onClick:()=>u(!0),variant:"outline",className:"w-full",size:"lg",children:[(0,n.jsx)(Q.A,{className:"h-4 w-4 mr-2"}),"Open Scanner"]})]})})})]}),i&&8===i.length&&(0,n.jsx)(l,{className:"border-blue-200 bg-blue-50/50 dark:border-blue-800 dark:bg-blue-950/50",children:(0,n.jsx)(h,{className:"p-4",children:(0,n.jsx)("div",{className:"text-center",children:(0,n.jsxs)("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:["Ready to connect with room code: ",(0,n.jsx)("span",{className:"font-mono font-bold",children:i})]})})})})]})}var $=s(5863);function W(e){let{className:t,value:s,...r}=e;return(0,n.jsx)($.bL,{"data-slot":"progress",className:(0,a.cn)("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",t),...r,children:(0,n.jsx)($.C1,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:"translateX(-".concat(100-(s||0),"%)")}})})}var G=s(4861),H=s(1154),J=s(646),V=s(4357),q=s(5169),X=s(133);function Y(e){let{transferState:t,roomCode:s,receivedFiles:o,onCancel:a,onReset:d,onCancelFile:u}=e,[m,g]=(0,r.useState)(""),x=o.length>0;(0,r.useEffect)(()=>{s&&(async()=>{try{let e="".concat(window.location.origin).concat(window.location.pathname,"?receive=").concat(s),t=await D.toDataURL(e,{width:200,margin:2,color:{dark:"#000000",light:"#FFFFFF"}});g(t)}catch(e){console.error("Error generating QR code:",e)}})()},[s]);let p=async()=>{try{navigator.clipboard&&window.isSecureContext?await navigator.clipboard.writeText(s):b(s),k.o.success("Room code copied to clipboard!")}catch(e){b(s),k.o.success("Room code copied to clipboard!")}},v=async()=>{let e="".concat(window.location.origin).concat(window.location.pathname,"?receive=").concat(s);try{navigator.clipboard&&window.isSecureContext?await navigator.clipboard.writeText(e):b(e),k.o.success("Share link copied to clipboard!")}catch(t){b(e),k.o.success("Share link copied to clipboard!")}},b=e=>{let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-9999px",t.style.top="-9999px",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")}catch(e){console.error("Fallback copy failed:",e)}document.body.removeChild(t)},w=e=>{try{(e=>{console.log("downloadFile called with:",e.name,e.size,"bytes");try{let t=URL.createObjectURL(e);console.log("Created object URL:",t);let s=document.createElement("a");if(s.href=t,s.download=e.name,!s.download){console.error("Download attribute not supported or not set properly"),window.open(t,"_blank");return}if(console.log("Created download link - href:",s.href,"download:",s.download),s.style.position="fixed",s.style.top="-1000px",s.style.left="-1000px",s.style.visibility="hidden",document.body.appendChild(s),console.log("Link added to document body"),"function"==typeof s.click)s.click(),console.log("Link clicked successfully");else{let e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0),s.dispatchEvent(e),console.log("Click event dispatched")}setTimeout(()=>{try{document.body.contains(s)&&document.body.removeChild(s),URL.revokeObjectURL(t),console.log("Cleanup completed successfully")}catch(e){console.warn("Cleanup error (non-critical):",e)}},200)}catch(t){console.error("Download failed:",t);try{let t=URL.createObjectURL(e);window.open(t,"_blank")?console.log("Opened file in new window as fallback"):console.error("Failed to open file - popup blocker may be active")}catch(e){console.error("All download methods failed:",e)}}})(e),k.o.success("Downloaded ".concat(e.name))}catch(e){console.error("Error downloading file:",e),k.o.error("Failed to download file")}},y=(()=>{switch(t.status){case"idle":return{icon:(0,n.jsx)(G.A,{className:"h-6 w-6 text-gray-400"}),title:"Ready to Transfer",description:"Waiting for connection",color:"gray"};case"connecting":return{icon:(0,n.jsx)(H.A,{className:"h-6 w-6 animate-spin text-blue-500"}),title:"Connecting...",description:"Establishing peer-to-peer connection",color:"blue"};case"transferring":return{icon:(0,n.jsx)(H.A,{className:"h-6 w-6 animate-spin text-purple-500"}),title:"Transferring Files",description:"Transfer in progress...",color:"purple"};case"completed":return{icon:(0,n.jsx)(J.A,{className:"h-6 w-6 text-green-500"}),title:"Transfer Complete!",description:"All files transferred successfully",color:"green"};case"error":return{icon:(0,n.jsx)(G.A,{className:"h-6 w-6 text-red-500"}),title:"Transfer Failed",description:t.error||"An error occurred during transfer",color:"red"};default:return{icon:(0,n.jsx)(G.A,{className:"h-6 w-6 text-gray-400"}),title:"Unknown Status",description:"Please try again",color:"gray"}}})(),j="transferring"===t.status,N="completed"===t.status,F="error"===t.status;return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"space-y-6",children:[("idle"===t.status||"connecting"===t.status)&&(0,n.jsx)(l,{children:(0,n.jsx)(h,{className:"pt-6",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-medium",children:"Room Code"}),(0,n.jsx)("p",{className:"text-2xl font-mono font-bold tracking-wider",children:s})]}),(0,n.jsx)("div",{className:"flex gap-2 flex-wrap",children:(0,n.jsxs)(E.$,{onClick:p,variant:"outline",size:"sm",children:[(0,n.jsx)(V.A,{className:"h-4 w-4 mr-2"}),"Copy Code"]})})]})})}),!x&&m&&("idle"===t.status||"connecting"===t.status)&&(0,n.jsx)(l,{children:(0,n.jsx)(h,{className:"pt-6",children:(0,n.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,n.jsx)("h3",{className:"font-medium",children:"QR Code"}),(0,n.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,n.jsx)("img",{src:m,alt:"QR Code for sharing",className:"border rounded-lg"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground text-center",children:"Scan with receiver's device to connect"}),(0,n.jsxs)(E.$,{onClick:v,variant:"outline",size:"sm",className:"w-full sm:w-auto",children:[(0,n.jsx)(V.A,{className:"h-4 w-4 mr-2"}),"Copy Share Link"]})]})]})})}),(0,n.jsx)(l,{children:(0,n.jsx)(h,{className:"pt-6",children:(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[y.icon,(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("h3",{className:"font-medium text-lg",children:y.title}),(0,n.jsx)("p",{className:"text-muted-foreground",children:y.description})]})]})})}),t.files.length>0&&(0,n.jsxs)(l,{"data-transfer-card":!0,children:[(0,n.jsx)(i,{children:(0,n.jsxs)(c,{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{children:"File Transfer"}),(0,n.jsxs)(f,{variant:"secondary",children:[t.files.length," files"]})]})}),(0,n.jsxs)(h,{children:[(0,n.jsx)("div",{className:"space-y-3",children:t.files.map((e,s)=>{let r=t.progress.find(e=>e.fileIndex===s),a=r&&r.progress<100&&j&&!r.cancelled,l=N||r&&r.progress>=100&&!r.cancelled,i=r&&r.progress>=100&&!r.cancelled,c=null==r?void 0:r.cancelled,d=r&&r.progress>0&&!r.cancelled,h=j&&!d&&!c;return(0,n.jsxs)("div",{"data-file-item":!0,className:"border rounded-lg p-4 space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(0,n.jsx)(I.A,{className:"h-5 w-5 text-muted-foreground flex-shrink-0"}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("div",{className:"font-medium truncate",children:e.name}),(0,n.jsxs)("div",{className:"text-sm text-muted-foreground",children:[A(e.size||(null==r?void 0:r.totalBytes)||0),c?(0,n.jsx)(n.Fragment,{children:" • Transfer cancelled"}):i?(0,n.jsx)(n.Fragment,{children:" • Transfer completed"}):d&&r?(0,n.jsxs)(n.Fragment,{children:[" • ",A(r.bytesTransferred)," transferring"]}):null]})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[d&&r&&r.progress<100&&(0,n.jsxs)("div",{className:"text-right text-xs text-muted-foreground mr-2",children:[(0,n.jsx)("div",{children:r.speed&&r.speed>0?A(r.speed)+"/s":"Calculating..."}),(0,n.jsx)("div",{children:r.speed&&r.speed>0&&r.totalBytes?(e=>{if(!isFinite(e))return"∞";let t=Math.floor(e/3600),s=Math.floor(e%3600/60),n=Math.floor(e%60);return t>0?"".concat(t,"h ").concat(s,"m"):s>0?"".concat(s,"m ").concat(n,"s"):"".concat(n,"s")})((r.totalBytes-r.bytesTransferred)/r.speed):"ETA: Calculating..."})]}),c?(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(G.A,{className:"h-5 w-5 text-red-500"}),(0,n.jsxs)(f,{variant:"destructive",className:"text-xs",children:["Cancelled by ",null==r?void 0:r.cancelledBy]})]}):i?(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(J.A,{className:"h-5 w-5 text-green-500"}),x&&(0,n.jsx)(E.$,{variant:"outline",size:"sm",onClick:()=>{let t=o.find(t=>t.name===e.name&&t.size===e.size);t?w(t):(w(new File([new Blob(["File data not available"],{type:"text/plain"})],e.name,{type:e.type||"application/octet-stream"})),k.o.warning("".concat(e.name," downloaded as placeholder - original file data not available")))},children:(0,n.jsx)(C.A,{className:"h-4 w-4"})})]}):a?(0,n.jsx)("div",{className:"flex items-center gap-2",children:(0,n.jsx)(H.A,{className:"h-5 w-5 animate-spin text-blue-500"})}):h?(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"w-5 h-5 rounded-full bg-muted flex-shrink-0"}),u&&(0,n.jsx)(E.$,{variant:"outline",size:"sm",onClick:()=>u(s),title:"Remove from queue",children:(0,n.jsx)(U.A,{className:"h-4 w-4"})})]}):(0,n.jsx)("div",{className:"w-5 h-5 rounded-full bg-muted flex-shrink-0"})]})]}),!c&&(d||l)&&(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)(W,{value:r?r.progress:100*!!l,className:"h-2"}),(0,n.jsxs)("div",{className:"flex justify-between text-xs text-muted-foreground",children:[(0,n.jsxs)("span",{children:[r?Math.round(r.progress):100*!!l,"%"]}),r&&(0,n.jsxs)("span",{children:[A(r.bytesTransferred)," / ",A(r.totalBytes)]})]})]})]},s)})}),x&&t.files.length>1&&(()=>{let e=t.files.filter((e,s)=>{let n=t.progress.find(e=>e.fileIndex===s);return n&&n.progress>=100&&!n.cancelled});return e.length>1?(0,n.jsx)("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:(0,n.jsxs)(E.$,{onClick:()=>{let t=0;e.forEach(e=>{let s=o.find(t=>t.name===e.name&&t.size===e.size);s&&(w(s),t++)}),t>0?k.o.success("Downloaded ".concat(t," files")):k.o.error("No files available for download")},className:"w-full",children:[(0,n.jsx)(C.A,{className:"h-4 w-4 mr-2"}),"Download All (",e.length," files)"]})}):null})(),(0,n.jsx)("div",{className:"mt-6 flex gap-3",children:F?(0,n.jsxs)(E.$,{onClick:d,variant:"outline",className:"flex-1",children:[(0,n.jsx)(q.A,{className:"h-4 w-4 mr-2"}),"Back to Main"]}):j?(0,n.jsxs)(E.$,{onClick:a,variant:"outline",className:"flex-1",children:[(0,n.jsx)(U.A,{className:"h-4 w-4 mr-2"}),"Cancel Transfer"]}):(0,n.jsxs)(E.$,{onClick:d,variant:"outline",className:"flex-1",children:[(0,n.jsx)(X.A,{className:"h-4 w-4 mr-2"}),"New Transfer"]})})]})]})]})})}function K(){console.log("=== P2PFileTransfer COMPONENT RENDERING ===");let e=(0,o.useSearchParams)().get("receive");console.log("Next.js searchParams receive:",e);let[t,s]=(0,r.useState)(!1),[a,u]=(0,r.useState)(e?"receive":"send");console.log("Current activeTab in render:",a);let[m,g]=(0,r.useState)({status:"idle",files:[],progress:[]}),[F,R]=(0,r.useState)(""),[T,A]=(0,r.useState)([]),[E,z]=(0,r.useState)(!1),I=(0,r.useCallback)(()=>{M.cleanup(),R(""),A([]),g({status:"idle",files:[],progress:[]}),z(!1);{let e=new URL(window.location.href);e.search="",window.history.replaceState({},"",e.toString())}},[]);(0,r.useEffect)(()=>{console.log("=== SIMPLE useEffect TEST ===")},[]),(0,r.useEffect)(()=>{console.log("=== useEffect running ==="),console.log("typeof window:","object"),console.log("window.location:",window.location),console.log("window.location.search:",window.location.search),console.log("window.location.href:",window.location.href);{let e=new URLSearchParams(window.location.search).get("receive");console.log("receiveCode from URL:",e),e&&(console.log("QR code URL detected, switching to receive tab"),u("receive"),z(!0),window.history.replaceState({receiving:!0,roomCode:e},"",window.location.href))}},[]),(0,r.useEffect)(()=>{let e=async()=>{try{console.log("Attempting to connect to signaling server..."),console.log("Current connection state:",S.isConnected()),await new Promise(e=>setTimeout(e,500)),await S.connect(),console.log("Successfully connected to signaling server"),s(!0),k.o.success("Connected to signaling server")}catch(t){console.error("Failed to connect to signaling server:",t),k.o.error("Failed to connect to server: ".concat(t)),s(!1),setTimeout(()=>{console.log("Retrying connection..."),e()},2e3)}};return e(),S.onRoomFull(e=>{k.o.error("Room ".concat(e.room," is full! Only 2 people can share files at once.")),g(e=>({...e,status:"error",error:"Room is full"}))}),S.onRoomBusy(e=>{k.o.error("Room ".concat(e.room," is currently transferring files. Please try again later.")),g(e=>({...e,status:"error",error:"Room is busy"}))}),S.onRoomExpired(()=>{k.o.error("This share session has expired. Please create a new one."),I()}),S.onPeerDisconnected(e=>{console.log("Peer disconnected:",e),k.o.warning("Peer disconnected"),I()}),()=>{M.cleanup(),S.disconnect()}},[I]),(0,r.useEffect)(()=>{let e=e=>{if(console.log("Browser back button pressed, current state:",{roomCode:F,hasNavigatedToSharing:E}),console.log("PopState event state:",e.state),F||E){console.log("Resetting to main state due to back button"),I();let e=new URL(window.location.href);e.search="",window.history.replaceState({},"",e.toString())}},t=e=>{if(F&&("transferring"===m.status||"connecting"===m.status))return e.preventDefault(),e.returnValue="",""};return window.addEventListener("popstate",e),window.addEventListener("beforeunload",t),()=>{window.removeEventListener("popstate",e),window.removeEventListener("beforeunload",t)}},[F,E,I,m.status]),(0,r.useEffect)(()=>{M.onConnectionStateChange=e=>{console.log("WebRTC connection state:",e),"connected"===e?g(e=>({...e,status:"connecting"})):("failed"===e||"disconnected"===e)&&g(e=>({...e,status:"error",error:"Connection failed"}))},M.onDataChannelOpen=()=>{console.log("Data channel opened"),g(e=>({...e,status:"transferring"}))},M.onIncomingFiles=e=>{console.log("Incoming files:",e),g(t=>({...t,files:e,status:"transferring"}))},M.onTransferProgress=e=>{g(t=>({...t,progress:t.progress.map(t=>t.fileIndex===e.fileIndex?{fileIndex:e.fileIndex,fileName:e.fileName,progress:e.progress,speed:e.speed,bytesTransferred:e.bytesTransferred,totalBytes:e.totalBytes}:t).concat(t.progress.find(t=>t.fileIndex===e.fileIndex)?[]:[{fileIndex:e.fileIndex,fileName:e.fileName,progress:e.progress,speed:e.speed,bytesTransferred:e.bytesTransferred,totalBytes:e.totalBytes}])}))},M.onFileReceived=e=>{console.log("onFileReceived called with file:",e.name,e.size,"bytes"),A(t=>[...t,e]),k.o.success("File received: ".concat(e.name),{description:"Click the download button to save the file",duration:5e3})},M.onTransferComplete=()=>{g(e=>({...e,status:"completed"})),k.o.success("Transfer completed successfully!")},M.onTransferCancelled=e=>{k.o.warning("Transfer cancelled by ".concat(e)),g(t=>({...t,status:"error",error:"Transfer cancelled by ".concat(e)}))},M.onFileCancelled=e=>{k.o.warning('File "'.concat(e.fileName,'" cancelled by ').concat(e.cancelledBy)),g(t=>({...t,progress:[...t.progress.filter(t=>t.fileIndex!==e.fileIndex),{fileIndex:e.fileIndex,fileName:e.fileName,progress:0,speed:0,bytesTransferred:0,totalBytes:0,cancelled:!0,cancelledBy:e.cancelledBy}]}))},M.onError=e=>{k.o.error(e),g(t=>({...t,status:"error",error:e}))}},[I]);let B=(0,r.useCallback)(e=>{let t=m.files[e];t&&(M.cancelFile(e,t.name),g(s=>({...s,progress:[...s.progress.filter(t=>t.fileIndex!==e),{fileIndex:e,fileName:t.name,progress:0,speed:0,bytesTransferred:0,totalBytes:t.size,cancelled:!0,cancelledBy:M.currentRole}]})),k.o.info('File "'.concat(t.name,'" cancelled')))},[m.files]),D=(0,r.useCallback)(async e=>{if(console.log("handleSendFiles called in main component"),console.log("isConnected:",t),console.log("files:",e),!t){console.log("Not connected to signaling server"),k.o.error("Not connected to signaling server");return}let s=(()=>{let e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",t="";for(let s=0;s<8;s++)t+=e.charAt(Math.floor(Math.random()*e.length));return t})();console.log("Generated room code:",s),R(s),z(!0);let n=new URL(window.location.href);n.searchParams.set("sharing",s),window.history.pushState({sharing:!0,roomCode:s},"",n.toString()),g({status:"connecting",files:e.map((e,t)=>({name:e.name,size:e.size,type:e.type,lastModified:e.lastModified,fileIndex:t})),progress:[]}),window.scrollTo({top:0,behavior:"smooth"});try{console.log("Joining room:",s),S.joinRoom(s),S.onPeerJoined(async t=>{console.log("Peer joined:",t),k.o.success("Receiver connected! Starting transfer..."),await M.initializeAsSender(s,e)})}catch(e){console.error("Failed to initialize sender:",e),k.o.error("Failed to start file sharing"),I()}},[t,I]),L=(0,r.useCallback)(async e=>{if(!t)return void k.o.error("Not connected to signaling server");R(e),z(!0);let s=new URL(window.location.href);s.searchParams.has("receive")||(s.searchParams.set("receive",e),window.history.pushState({receiving:!0,roomCode:e},"",s.toString())),g({status:"connecting",files:[],progress:[]});try{S.joinRoom(e),await M.initializeAsReceiver(e),k.o.success("Connected to sender. Waiting for files...")}catch(e){console.error("Failed to initialize receiver:",e),k.o.error("Failed to join file sharing session"),I()}},[t,I]),U=(0,r.useCallback)(()=>{M.cancelTransfer(),I()},[I]);return(0,n.jsxs)("div",{className:"min-h-screen w-full relative",children:[(0,n.jsx)("div",{className:"absolute inset-0 z-0",style:{background:"radial-gradient(125% 125% at 50% 90%, #fff 40%, #6366f1 100%)"}}),(0,n.jsxs)("div",{className:"relative z-10 min-h-screen flex flex-col items-center justify-center p-6",children:[(0,n.jsxs)(l,{className:"w-full max-w-2xl bg-background/80 backdrop-blur-xl border-white/20 shadow-2xl",children:[(0,n.jsxs)(i,{className:"text-center",children:[(0,n.jsxs)("div",{className:"flex items-center justify-center gap-3 mb-4",children:[(0,n.jsx)("div",{className:"p-3 rounded-full bg-gradient-to-r from-blue-500 to-purple-500",children:(0,n.jsx)(w.A,{className:"h-6 w-6 text-white"})}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[t?(0,n.jsx)(y.A,{className:"h-5 w-5 text-green-500"}):(0,n.jsx)(j.A,{className:"h-5 w-5 text-red-500"}),(0,n.jsx)(f,{variant:t?"default":"destructive",children:t?"Connected":"Disconnected"})]})]}),(0,n.jsx)(c,{className:"text-4xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent leading-tight pb-2",children:"Sendify"}),(0,n.jsx)(d,{className:"text-lg text-muted-foreground",children:"Secure peer-to-peer file sharing"})]}),(0,n.jsx)(h,{children:"idle"===m.status?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(x,{value:a,onValueChange:e=>u(e),className:"w-full",children:[(0,n.jsxs)(p,{className:"grid w-full grid-cols-2",children:[(0,n.jsxs)(v,{value:"send",className:"flex items-center gap-2 transition-all duration-200 ease-in-out",children:[(0,n.jsx)(N.A,{className:"h-4 w-4"}),"Send Files"]}),(0,n.jsxs)(v,{value:"receive",className:"flex items-center gap-2 transition-all duration-200 ease-in-out",children:[(0,n.jsx)(C.A,{className:"h-4 w-4"}),"Receive Files"]})]}),(0,n.jsx)(b,{value:"send",className:"mt-6 transition-all duration-300 ease-in-out",children:(0,n.jsx)(P,{onSendFiles:D,disabled:!t,roomCode:F})}),(0,n.jsx)(b,{value:"receive",className:"mt-6 transition-all duration-300 ease-in-out",children:(0,n.jsx)(_,{onReceiveFiles:L,disabled:!t})})]})}):(0,n.jsx)(Y,{transferState:m,roomCode:F,receivedFiles:T,onCancel:U,onReset:I,onCancelFile:B})})]}),(0,n.jsx)("div",{className:"mt-6 w-full max-w-2xl text-center",children:(0,n.jsxs)("div",{className:"text-black/80",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Sendify"}),(0,n.jsx)("p",{className:"text-sm text-black/70 mb-1",children:"Secure, fast, and private peer-to-peer file sharing"}),(0,n.jsx)("p",{className:"text-sm text-black/70",children:"No servers, no storage, direct device-to-device transfer"})]})}),(0,n.jsx)("div",{className:"mt-8 w-full max-w-2xl",children:(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 text-black/80",children:[(0,n.jsx)("div",{className:"text-sm",children:"Built with ❤️ for secure P2P file sharing"}),(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)("a",{href:"https://github.com/10neWOlF",target:"_blank",rel:"noopener noreferrer",className:"text-black/60 hover:text-black transition-colors",title:"GitHub",children:(0,n.jsx)("svg",{className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"})})}),(0,n.jsx)("a",{href:"https://x.com/ShubhamPardule",target:"_blank",rel:"noopener noreferrer",className:"text-black/60 hover:text-black transition-colors",title:"X (Twitter)",children:(0,n.jsx)("svg",{className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"})})})]})]})})]})]})}},9434:(e,t,s)=>{"use strict";s.d(t,{cn:()=>o});var n=s(2596),r=s(9688);function o(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.QP)((0,n.$)(t))}}},e=>{e.O(0,[369,441,964,358],()=>e(e.s=387)),_N_E=e.O()}]);